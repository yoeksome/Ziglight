###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         08/Jun/2017  17:38:54 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\Source\ZigLightApp.c              #
#    Command line       =  -f E:\work\smartlight\ZigLight001\Projects\zstack\ #
#                          Samples\ZigLightApp\CC2530DB\..\..\..\Tools\CC2530 #
#                          DB\f8wCoord.cfg (-DCPU32MHZ -DROOT=__near_func     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f E:\work\smartlight\ZigLight001\Projects\zstack\ #
#                          Samples\ZigLightApp\CC2530DB\..\..\..\Tools\CC2530 #
#                          DB\f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0           #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFF00                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 E:\work\smartlight\ZigLight #
#                          001\Projects\zstack\Samples\ZigLightApp\Source\Zig #
#                          LightApp.c -D ZTOOL_P1 -D NV_RESTORE -D            #
#                          MWK_MANAGER -D xMT_TASK -D xMT_SYS_FUNC -D         #
#                          xMT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -lC           #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\CoordinatorEB\List\ -lA  #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\CoordinatorEB\List\      #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\CoordinatorEB\Obj\ -e    #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I E:\work\smartlight\ZigLight001\Projects\zstack\ #
#                          Samples\ZigLightApp\CC2530DB\ -I                   #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\Source\ -I            #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\ZMain\TI2530DB\ #
#                           -I E:\work\smartlight\ZigLight001\Projects\zstack #
#                          \Samples\ZigLightApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\hal\include\ -I E:\work\smartlight\ZigLight0 #
#                          01\Projects\zstack\Samples\ZigLightApp\CC2530DB\.. #
#                          \..\..\..\..\Components\hal\target\CC2530EB\ -I    #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\include\ -I E:\work\smartlight\ZigLight001\P #
#                          rojects\zstack\Samples\ZigLightApp\CC2530DB\..\..\ #
#                          ..\..\..\Components\mac\high_level\ -I             #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\low_level\srf04\ -I                          #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\low_level\srf04\single_chip\ -I              #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mt\ -I E:\work\smartlight\ZigLight001\Projects\z #
#                          stack\Samples\ZigLightApp\CC2530DB\..\..\..\..\..\ #
#                          Components\osal\include\ -I                        #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\services\saddr\ -I E:\work\smartlight\ZigLight00 #
#                          1\Projects\zstack\Samples\ZigLightApp\CC2530DB\..\ #
#                          ..\..\..\..\Components\services\sdata\ -I          #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\af\ -I E:\work\smartlight\ZigLight001\Proj #
#                          ects\zstack\Samples\ZigLightApp\CC2530DB\..\..\..\ #
#                          ..\..\Components\stack\nwk\ -I                     #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sapi\ -I E:\work\smartlight\ZigLight001\Pr #
#                          ojects\zstack\Samples\ZigLightApp\CC2530DB\..\..\. #
#                          .\..\..\Components\stack\sec\ -I                   #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sys\ -I E:\work\smartlight\ZigLight001\Pro #
#                          jects\zstack\Samples\ZigLightApp\CC2530DB\..\..\.. #
#                          \..\..\Components\stack\zdo\ -I                    #
#                          E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\..\..\..\..\..\Component #
#                          s\zmac\ -I E:\work\smartlight\ZigLight001\Projects #
#                          \zstack\Samples\ZigLightApp\CC2530DB\..\..\..\..\. #
#                          .\Components\zmac\f8w\ -Ohz --require_prototypes   #
#    List file          =  E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\CoordinatorEB\List\ZigLi #
#                          ghtApp.lst                                         #
#    Object file        =  E:\work\smartlight\ZigLight001\Projects\zstack\Sam #
#                          ples\ZigLightApp\CC2530DB\CoordinatorEB\Obj\ZigLig #
#                          htApp.r51                                          #
#                                                                             #
#                                                                             #
###############################################################################

E:\work\smartlight\ZigLight001\Projects\zstack\Samples\ZigLightApp\Source\ZigLightApp.c
      1          /**************************************************************************************************
      2            Filename:       ZigLightApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Sample Application (no Profile).
      7          
      8          
      9            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends it's messages either as broadcast or
     45            broadcast filtered group messages.  The other (more normal)
     46            message addressing is unicast.  Most of the other sample
     47            applications are written to support the unicast message model.
     48          
     49            Key control:
     50              SW1:  Sends a flash command to all devices in Group 1.
     51              SW2:  Adds/Removes (toggles) this device in and out
     52                    of Group 1.  This will enable and disable the
     53                    reception of the flash command.
     54          *********************************************************************/
     55          /**
     56          *   熟悉zigbee工程    2017/5/23 by liu
     57          *   增加协调器与设备通信功能  2017/5/25 by liu
     58          *   加入链表管理mac功能 2017/5/27 by liu
     59          *   修改串口通信部分却掉串口调试功能 2017/6/5 by liu
     60          *   加入机智云串口通信协议 2017/6/5 by liu
     61          *   修改APSME_LookupExtAddr函数失败后请求mac地址功能  2017/6/5 by liu
     62          *   修改了串口通信 2017/6/7 by liu
     63          *   增加链表储存短地址功能   2017/6/7 by liu
     64          *   增加短地址查询功能   2017/6/7 by liu
     65          *   增加按键发送重新配置机智云功能 2017/6/8 by liu
     66          *   处于配置态时1s闪烁 255次 2017/6/8 by liu
     67          *   不处于配置态且没有连上路由器时2s闪烁 8次 2017/6/8 by liu
     68          *   不处于配置态&&连上路由器&&没有连上机智云时3s闪烁 10次 2017/6/8 by liu
     69          *   不处于配置态&&连上路由器&&连上机智云时长亮 2017/6/8 by liu
     70          **/
     71          /*********************************************************************
     72           * INCLUDES
     73           */
     74          #include "OSAL.h"
     75          #include "ZGlobals.h"
     76          #include "AF.h"
     77          #include "aps_groups.h"
     78          #include "ZDApp.h"
     79          
     80          #include "ZigLightApp.h"
     81          #include "ZigLightAppHw.h"
     82          
     83          #include "OnBoard.h"
     84          
     85          /* HAL */
     86          #include "hal_lcd.h"
     87          #include "hal_led.h"
     88          #include "hal_key.h"
     89          
     90          #include  "MT_UART.h" //此处用于串口
     91          #include  "List1.h"
     92          #include  "gizwits_protocol.h"
     93          #include  "ZDObject.h"
     94          /*********************************************************************
     95           * MACROS
     96           */
     97          
     98          /*********************************************************************
     99           * CONSTANTS
    100           */
    101          
    102          /*********************************************************************
    103           * TYPEDEFS
    104           */
    105          
    106          /*********************************************************************
    107           * GLOBAL VARIABLES
    108           */
    109          
    110          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    111          const cId_t ZigLightApp_ClusterList[ZigLightApp_MAX_CLUSTERS] =
   \                     ZigLightApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
   \   000004   0000         DW 0
    112          {
    113            ZigLightApp_PERIODIC_CLUSTERID,
    114            ZigLightApp_FLASH_CLUSTERID
    115          };
    116          

   \                                 In  segment XDATA_ROM_C, align 1
    117          const SimpleDescriptionFormat_t ZigLightApp_SimpleDesc =
   \                     ZigLightApp_SimpleDesc:
   \   000000   14           DB 20
   \   000001   080F         DW 3848
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   03           DB 3
   \   000007   ....         DW ZigLightApp_ClusterList
   \   000009   03           DB 3
   \   00000A   ....         DW ZigLightApp_ClusterList
    118          {
    119            ZigLightApp_ENDPOINT,              //  int Endpoint;
    120            ZigLightApp_PROFID,                //  uint16 AppProfId[2];
    121            ZigLightApp_DEVICEID,              //  uint16 AppDeviceId[2];
    122            ZigLightApp_DEVICE_VERSION,        //  int   AppDevVer:4;
    123            ZigLightApp_FLAGS,                 //  int   AppFlags:4;
    124            ZigLightApp_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    125            (cId_t *)ZigLightApp_ClusterList,  //  uint8 *pAppInClusterList;
    126            ZigLightApp_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    127            (cId_t *)ZigLightApp_ClusterList   //  uint8 *pAppInClusterList;
    128          };
    129          
    130          // This is the Endpoint/Interface description.  It is defined here, but
    131          // filled-in in ZigLightApp_Init().  Another way to go would be to fill
    132          // in the structure here and make it a "const" (in code space).  The
    133          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    134          endPointDesc_t ZigLightApp_epDesc;
   \                     ZigLightApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    135          
    136          /*********************************************************************
    137           * EXTERNAL VARIABLES
    138           */
    139          
    140          /*********************************************************************
    141           * EXTERNAL FUNCTIONS
    142           */
    143          
    144          /*********************************************************************
    145           * LOCAL VARIABLES
    146           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          uint8 ZigLightApp_TaskID;   // Task ID for internal task/event processing
   \                     ZigLightApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    148                                    // This variable will be received when
    149                                    // ZigLightApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          devStates_t ZigLightApp_NwkState;
   \                     ZigLightApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    151          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          uint8 ZigLightApp_TransID;  // This is the unique message ID (counter)
   \                     ZigLightApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          afAddrType_t ZigLightApp_Periodic_DstAddr;
   \                     ZigLightApp_Periodic_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          afAddrType_t ZigLightApp_Flash_DstAddr;
   \                     ZigLightApp_Flash_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    156          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    157          afAddrType_t Point_To_Point_DstAddr;//网蜂点对点通信定义
   \                     Point_To_Point_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    158          /****************by liu ***********************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    159          afAddrType_t Self_DstAddr;//by liu
   \                     Self_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    160          zAddrType_t Self_zDstAddr;//by liu
   \                     Self_zDstAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    161          uint8 self_index=1;//by liu
   \                     self_index:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for self_index>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    162          uint8 sbuf[6];//by liu
   \                     sbuf:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    163          uint8 sbuf_len;//by liu
   \                     sbuf_len:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    164          uint8 on_off;//by liu
   \                     on_off:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    165          uint8 white,red,green,blue;//by liu
   \                     white:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     red:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     green:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     blue:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    166          uint8 gizwits_buf[20];
   \                     gizwits_buf:
   \   000000                DS 20
   \   000014                REQUIRE __INIT_XDATA_Z
    167          enum mstate{
    168            POWER_ON=0X10,
    169            ESTABLISH_CONNECTION_REQ,//router & end send
    170            ESTABLISH_CONNECTION_RSQ,//coordinate send
    171            HEARTBEAT,//router & end send
    172            DEVICE_STATUS_CHANGE,//router & end send
    173            DEVICE_COMMAND//coordinate send
    174            
    175            };//by liu

   \                                 In  segment XDATA_I, align 1, keep-with-next
    176          uint8 main_state = ESTABLISH_CONNECTION_REQ;//by liu
   \                     main_state:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for main_state>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    177          Node *nodelist;
   \                     nodelist:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    178          Node *deletnodelist=NULL;
   \                     deletnodelist:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    179          uint8 newdevice_joinin=0;//新O浼尤苏I =0o效 =1加入成功 = 2却娣峙涑鲥e = 3函数APSME_LookupExtAddr无法找到mac
   \                     newdevice_joinin:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    180          #define SERIAL_INCOMING_MSG                  0xE1
    181          //typedef struct
    182          //{
    183          //  osal_event_hdr_t  hdr;
    184          //  uint8             *msg;
    185          //} mtOSALSerialData_t;
    186          extern uint8 currentMac[8];
    187          extern uint8 MacToAppFlag ;//by liu
    188          extern uint8 AutoUpateMac ;//by liu
    189          dataPoint_t currentDataPoint;// by liu
    190          extern uint8 blink_finished ;//by liu =1 完成闪烁 =0 没有完成闪烁
    191          /****************by liu end***********************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    192          aps_Group_t ZigLightApp_Group;
   \                     ZigLightApp_Group:
   \   000000                DS 18
   \   000012                REQUIRE __INIT_XDATA_Z
    193          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    194          uint8 ZigLightAppPeriodicCounter = 0;
   \                     ZigLightAppPeriodicCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    195          uint8 ZigLightAppFlashCounter = 0;
   \                     ZigLightAppFlashCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    196          dataPoint_t currentDataPoint;
   \                     currentDataPoint:
   \   000000                DS 20
   \   000014                REQUIRE __INIT_XDATA_Z
    197          /*********************************************************************
    198           * LOCAL FUNCTIONS
    199           */
    200          void ZigLightApp_HandleKeys( uint8 shift, uint8 keys );
    201          void ZigLightApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    202          void ZigLightApp_SendPeriodicMessage( void );
    203          void ZigLightApp_SendFlashMessage( uint16 flashTime );
    204          void ZigLightApp_SendPointToPointMessage( afAddrType_t * dstaddr , endPointDesc_t * epdesc , uint16 len , uint8 * buf  );
    205          uint8 SendData_load(uint8 *sbuf);//by liu
    206          void rfdata_handle( afIncomingMSGPacket_t *pkt );//by liu
    207          void serial_data_handle(uint8 *ptr);//by liu
    208          void ZigLightApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );//by liu
    209          /*********************************************************************
    210           * NETWORK LAYER CALLBACKS
    211           */
    212          
    213          /*********************************************************************
    214           * PUBLIC FUNCTIONS
    215           */
    216          
    217          /*********************************************************************
    218           * @fn      ZigLightApp_Init
    219           *
    220           * @brief   Initialization function for the Generic App Task.
    221           *          This is called during initialization and should contain
    222           *          any application specific initialization (ie. hardware
    223           *          initialization/setup, table initialization, power up
    224           *          notificaiton ... ).
    225           *
    226           * @param   task_id - the ID assigned by OSAL.  This ID should be
    227           *                    used to send messages and set timers.
    228           *
    229           * @return  none
    230           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    231          void ZigLightApp_Init( uint8 task_id )
   \                     ZigLightApp_Init:
    232          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    233          //  uint8 i;
    234            ZigLightApp_TaskID = task_id;
   \   000007   90....       MOV     DPTR,#ZigLightApp_TaskID
   \   00000A   F0           MOVX    @DPTR,A
    235            ZigLightApp_NwkState = DEV_INIT;
   \   00000B   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   00000E   7401         MOV     A,#0x1
   \   000010   F0           MOVX    @DPTR,A
    236            ZigLightApp_TransID = 0;
   \   000011   90....       MOV     DPTR,#ZigLightApp_TransID
   \   000014   E4           CLR     A
   \   000015   F0           MOVX    @DPTR,A
    237            
    238            MT_UartInit();//串口初始化
   \   000016                ; Setup parameters for call to function MT_UartInit
   \   000016   12....       LCALL   ??MT_UartInit?relay
    239            MT_UartRegisterTaskID(task_id);//登记任务号
   \   000019                ; Setup parameters for call to function MT_UartRegisterTaskID
   \   000019   EE           MOV     A,R6
   \   00001A   F9           MOV     R1,A
   \   00001B   12....       LCALL   ??MT_UartRegisterTaskID?relay
    240            HalUARTWrite(0,"giziwit set mode\n",17); //（串口0，'字符'，字符个数。）
   \   00001E                ; Setup parameters for call to function HalUARTWrite
   \   00001E   7C11         MOV     R4,#0x11
   \   000020   7D00         MOV     R5,#0x0
   \   000022   7A..         MOV     R2,#`?<Constant "giziwit set mode\\n">` & 0xff
   \   000024   7B..         MOV     R3,#(`?<Constant "giziwit set mode\\n">` >> 8) & 0xff
   \   000026   7900         MOV     R1,#0x0
   \   000028   12....       LCALL   ??HalUARTWrite?relay
    241            osal_memset((uint8*)&currentDataPoint, 0, sizeof(dataPoint_t));
   \   00002B                ; Setup parameters for call to function osal_memset
   \   00002B   7C14         MOV     R4,#0x14
   \   00002D   7D00         MOV     R5,#0x0
   \   00002F   7900         MOV     R1,#0x0
   \   000031   7A..         MOV     R2,#currentDataPoint & 0xff
   \   000033   7B..         MOV     R3,#(currentDataPoint >> 8) & 0xff
   \   000035   12....       LCALL   ??osal_memset?relay
    242            gizwitsInit();
   \   000038                ; Setup parameters for call to function gizwitsInit
   \   000038   12....       LCALL   ??gizwitsInit?relay
    243          //  gizwitsSetMode(WIFI_AIRLINK_MODE);//airlink
    244            // Device hardware initialization can be added here or in main() (Zmain.c).
    245            // If the hardware is application specific - add it here.
    246            // If the hardware is other parts of the device add it in main().
    247          
    248           #if defined ( BUILD_ALL_DEVICES )
    249            // The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START
    250            // We are looking at a jumper (defined in ZigLightAppHw.c) to be jumpered
    251            // together - if they are - we will start up a coordinator. Otherwise,
    252            // the device will start as a router.
    253            if ( readCoordinatorJumper() )
    254              zgDeviceLogicalType = ZG_DEVICETYPE_COORDINATOR;
    255            else
    256              zgDeviceLogicalType = ZG_DEVICETYPE_ROUTER;
    257          #endif // BUILD_ALL_DEVICES
    258          
    259          #if defined ( HOLD_AUTO_START )
    260            // HOLD_AUTO_START is a compile option that will surpress ZDApp
    261            //  from starting the device and wait for the application to
    262            //  start the device.
    263            ZDOInitDevice(0);
    264          #endif
    265          
    266            // Setup for the periodic message's destination address
    267            // Broadcast to everyone
    268            ZigLightApp_Periodic_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
   \   00003B   90....       MOV     DPTR,#ZigLightApp_Periodic_DstAddr + 8
   \   00003E   740F         MOV     A,#0xf
   \   000040   F0           MOVX    @DPTR,A
    269            ZigLightApp_Periodic_DstAddr.endPoint = ZigLightApp_ENDPOINT;
   \   000041   A3           INC     DPTR
   \   000042   7414         MOV     A,#0x14
   \   000044   F0           MOVX    @DPTR,A
    270            ZigLightApp_Periodic_DstAddr.addr.shortAddr = 0xFFFF;
   \   000045   90....       MOV     DPTR,#ZigLightApp_Periodic_DstAddr
   \   000048   74FF         MOV     A,#-0x1
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   A3           INC     DPTR
   \   00004C   F0           MOVX    @DPTR,A
    271            
    272            // Setup for the flash command's destination address - Group 1
    273            ZigLightApp_Flash_DstAddr.addrMode = (afAddrMode_t)afAddrGroup;
   \   00004D   90....       MOV     DPTR,#ZigLightApp_Flash_DstAddr + 8
   \   000050   7401         MOV     A,#0x1
   \   000052   F0           MOVX    @DPTR,A
    274            ZigLightApp_Flash_DstAddr.endPoint = ZigLightApp_ENDPOINT;
   \   000053   A3           INC     DPTR
   \   000054   7414         MOV     A,#0x14
   \   000056   F0           MOVX    @DPTR,A
    275            ZigLightApp_Flash_DstAddr.addr.shortAddr = ZigLightApp_FLASH_GROUP;
   \   000057   90....       MOV     DPTR,#ZigLightApp_Flash_DstAddr
   \   00005A   7401         MOV     A,#0x1
   \   00005C   F0           MOVX    @DPTR,A
   \   00005D   A3           INC     DPTR
   \   00005E   E4           CLR     A
   \   00005F   F0           MOVX    @DPTR,A
    276            
    277            // 网蜂点对点通讯定义
    278            Point_To_Point_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;//点播
   \   000060   90....       MOV     DPTR,#Point_To_Point_DstAddr + 8
   \   000063   7402         MOV     A,#0x2
   \   000065   F0           MOVX    @DPTR,A
    279            Point_To_Point_DstAddr.endPoint = ZigLightApp_ENDPOINT;
   \   000066   A3           INC     DPTR
   \   000067   7414         MOV     A,#0x14
   \   000069   F0           MOVX    @DPTR,A
    280            Point_To_Point_DstAddr.addr.shortAddr = 0x0000; //发给协调器
   \   00006A   90....       MOV     DPTR,#Point_To_Point_DstAddr
   \   00006D   E4           CLR     A
   \   00006E   F0           MOVX    @DPTR,A
   \   00006F   A3           INC     DPTR
   \   000070   F0           MOVX    @DPTR,A
    281          //    for(i=0;i<8;i++)
    282          //      Point_To_Point_DstAddr.addr.extAddr[i] = 0x00; //发给协调器
    283          //    //test by liu 
    284          //    
    285          //    Self_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;//点播
    286          //    Self_DstAddr.endPoint = ZigLightApp_ENDPOINT;
    287          //    Self_DstAddr.addr.shortAddr = 0x0000; //发给协调器
    288          //    
    289          //    Self_zDstAddr.addrMode = (afAddrMode_t)Addr16Bit;//点播
    290          //    Self_zDstAddr.addr.shortAddr = 0x0000; //发给协调器
    291          //    //end test
    292            /****************************by liu *****************************/
    293            initList(&nodelist);
   \   000071                ; Setup parameters for call to function initList
   \   000071   7A..         MOV     R2,#nodelist & 0xff
   \   000073   7B..         MOV     R3,#(nodelist >> 8) & 0xff
   \   000075   12....       LCALL   ??initList?relay
    294          //  insertLastList(&nodelist,"12345678");
    295          //  insertLastList(&nodelist,"22045671");
    296            
    297            // Register callback evetns from the ZDApp
    298            ZDO_RegisterForZDOMsg( ZigLightApp_TaskID, IEEE_addr_rsp );
   \   000078                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000078   7A01         MOV     R2,#0x1
   \   00007A   7B80         MOV     R3,#-0x80
   \   00007C   90....       MOV     DPTR,#ZigLightApp_TaskID
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   F9           MOV     R1,A
   \   000081   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    299            /***************************by liu end ***************************/
    300            // Fill out the endpoint description.
    301            ZigLightApp_epDesc.endPoint = ZigLightApp_ENDPOINT;
   \   000084   90....       MOV     DPTR,#ZigLightApp_epDesc
   \   000087   7414         MOV     A,#0x14
   \   000089   F0           MOVX    @DPTR,A
    302            ZigLightApp_epDesc.task_id = &ZigLightApp_TaskID;
   \   00008A   A3           INC     DPTR
   \   00008B   74..         MOV     A,#ZigLightApp_TaskID & 0xff
   \   00008D   F0           MOVX    @DPTR,A
   \   00008E   A3           INC     DPTR
   \   00008F   74..         MOV     A,#(ZigLightApp_TaskID >> 8) & 0xff
   \   000091   F0           MOVX    @DPTR,A
    303            ZigLightApp_epDesc.simpleDesc
    304                      = (SimpleDescriptionFormat_t *)&ZigLightApp_SimpleDesc;
   \   000092   A3           INC     DPTR
   \   000093   74..         MOV     A,#ZigLightApp_SimpleDesc & 0xff
   \   000095   F0           MOVX    @DPTR,A
   \   000096   A3           INC     DPTR
   \   000097   74..         MOV     A,#(ZigLightApp_SimpleDesc >> 8) & 0xff
   \   000099   F0           MOVX    @DPTR,A
    305            ZigLightApp_epDesc.latencyReq = noLatencyReqs;
   \   00009A   A3           INC     DPTR
   \   00009B   E4           CLR     A
   \   00009C   F0           MOVX    @DPTR,A
    306          
    307            // Register the endpoint description with the AF
    308            afRegister( &ZigLightApp_epDesc );
   \   00009D                ; Setup parameters for call to function afRegister
   \   00009D   7A..         MOV     R2,#ZigLightApp_epDesc & 0xff
   \   00009F   7B..         MOV     R3,#(ZigLightApp_epDesc >> 8) & 0xff
   \   0000A1   12....       LCALL   ??afRegister?relay
    309          
    310            // Register for all key events - This app will handle all key events
    311            RegisterForKeys( ZigLightApp_TaskID );
   \   0000A4                ; Setup parameters for call to function RegisterForKeys
   \   0000A4   90....       MOV     DPTR,#ZigLightApp_TaskID
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F9           MOV     R1,A
   \   0000A9   12....       LCALL   ??RegisterForKeys?relay
    312          
    313            // By default, all devices start out in Group 1
    314            ZigLightApp_Group.ID = 0x0001;
   \   0000AC   90....       MOV     DPTR,#ZigLightApp_Group
   \   0000AF   7401         MOV     A,#0x1
   \   0000B1   F0           MOVX    @DPTR,A
   \   0000B2   A3           INC     DPTR
   \   0000B3   E4           CLR     A
   \   0000B4   F0           MOVX    @DPTR,A
    315            osal_memcpy( ZigLightApp_Group.name, "Group 1", 7  );
   \   0000B5                ; Setup parameters for call to function osal_memcpy
   \   0000B5   75....       MOV     ?V0 + 0,#`?<Constant "Group 1">` & 0xff
   \   0000B8   75....       MOV     ?V0 + 1,#(`?<Constant "Group 1">` >> 8) & 0xff
   \   0000BB   F5..         MOV     ?V0 + 2,A
   \   0000BD   78..         MOV     R0,#?V0 + 0
   \   0000BF   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000C2   7C07         MOV     R4,#0x7
   \   0000C4   7D00         MOV     R5,#0x0
   \   0000C6   7A..         MOV     R2,#(ZigLightApp_Group + 2) & 0xff
   \   0000C8   7B..         MOV     R3,#((ZigLightApp_Group + 2) >> 8) & 0xff
   \   0000CA   12....       LCALL   ??osal_memcpy?relay
   \   0000CD   7403         MOV     A,#0x3
   \   0000CF   12....       LCALL   ?DEALLOC_XSTACK8
    316            aps_AddGroup( ZigLightApp_ENDPOINT, &ZigLightApp_Group );
   \   0000D2                ; Setup parameters for call to function aps_AddGroup
   \   0000D2   7A..         MOV     R2,#ZigLightApp_Group & 0xff
   \   0000D4   7B..         MOV     R3,#(ZigLightApp_Group >> 8) & 0xff
   \   0000D6   7914         MOV     R1,#0x14
   \   0000D8   12....       LCALL   ??aps_AddGroup?relay
    317          
    318          #if defined ( LCD_SUPPORTED )
    319            HalLcdWriteString( "ZigLightApp", HAL_LCD_LINE_1 );
    320          #endif
    321          }
   \   0000DB   7F03         MOV     R7,#0x3
   \   0000DD   02....       LJMP    ?BANKED_LEAVE_XDATA
    322          /***********************************add by liu*****************************************/
    323          /*****
    324          ZigLightApp_NwkState
    325          SendData_load 参数 ptr 缓存数组
    326          返回：数组有效字节数
    327          ****/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    328          uint8 SendData_load(uint8 *sbuf)
   \                     SendData_load:
    329          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    330            uint8 i;
    331          //  uint8 coordextaddr[8];
    332            switch(main_state){
   \   000004   90....       MOV     DPTR,#main_state
   \   000007   E0           MOVX    A,@DPTR
   \   000008   24EF         ADD     A,#-0x11
   \   00000A   6015         JZ      ??SendData_load_0
   \   00000C   14           DEC     A
   \   00000D   6059         JZ      ??SendData_load_1
   \   00000F   14           DEC     A
   \   000010   606D         JZ      ??SendData_load_2
   \   000012   14           DEC     A
   \   000013   7003         JNZ     $+5
   \   000015   02....       LJMP    ??SendData_load_3 & 0xFFFF
   \   000018   14           DEC     A
   \   000019   7003         JNZ     $+5
   \   00001B   02....       LJMP    ??SendData_load_4 & 0xFFFF
   \   00001E   02....       LJMP    ??SendData_load_5 & 0xFFFF
    333            case ESTABLISH_CONNECTION_REQ:
    334              {
    335                if(ZigLightApp_NwkState != DEV_ZB_COORD){
   \                     ??SendData_load_0:
   \   000021   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000024   E0           MOVX    A,@DPTR
   \   000025   6409         XRL     A,#0x9
   \   000027   602E         JZ      ??SendData_load_6
    336                  sbuf[0] = 0x00;
   \   000029   8A82         MOV     DPL,R2
   \   00002B   8B83         MOV     DPH,R3
   \   00002D   E4           CLR     A
   \   00002E   F0           MOVX    @DPTR,A
    337                  if(ZigLightApp_NwkState == DEV_ROUTER)
   \   00002F   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6407         XRL     A,#0x7
   \   000035   7009         JNZ     ??SendData_load_7
    338                    sbuf[1] = 0x01;
   \   000037   8A82         MOV     DPL,R2
   \   000039   8B83         MOV     DPH,R3
   \   00003B   A3           INC     DPTR
   \   00003C   7401         MOV     A,#0x1
   \   00003E   800C         SJMP    ??SendData_load_8
    339                  else if(ZigLightApp_NwkState == DEV_END_DEVICE)
   \                     ??SendData_load_7:
   \   000040   E0           MOVX    A,@DPTR
   \   000041   6406         XRL     A,#0x6
   \   000043   7008         JNZ     ??SendData_load_9
    340                    sbuf[1] = 0x02;
   \   000045   8A82         MOV     DPL,R2
   \   000047   8B83         MOV     DPH,R3
   \   000049   A3           INC     DPTR
   \   00004A   7402         MOV     A,#0x2
   \                     ??SendData_load_8:
   \   00004C   F0           MOVX    @DPTR,A
    341                  #ifdef GUOHUA_LIGHT
    342                  sbuf[1] |= GUOHUA_LIGHT;
   \                     ??SendData_load_9:
   \   00004D   8A82         MOV     DPL,R2
   \   00004F   8B83         MOV     DPH,R3
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   D2E2         SETB    0xE0 /* A   */.2
   \   000055   8008         SJMP    ??SendData_load_10
    343                  #endif
    344                  #ifdef GUOHUA_PLUG
    345                  sbuf[1] |= GUOHUA_PLUG;
    346                  #endif
    347                  #ifdef GUOHUA_POWERSTRIP
    348                  sbuf[1] |= GUOHUA_POWERSTRIP;
    349                  #endif
    350                }
    351                else{
    352                  sbuf[0] = 0xff;
   \                     ??SendData_load_6:
   \   000057   8A82         MOV     DPL,R2
   \   000059   8B83         MOV     DPH,R3
   \   00005B   74FF         MOV     A,#-0x1
   \   00005D   F0           MOVX    @DPTR,A
    353                  sbuf[1] = 0xff;
   \   00005E   A3           INC     DPTR
   \                     ??SendData_load_10:
   \   00005F   F0           MOVX    @DPTR,A
    354                }
    355                sbuf_len = 2;
   \   000060   90....       MOV     DPTR,#sbuf_len
   \   000063   7402         MOV     A,#0x2
   \   000065   02....       LJMP    ??SendData_load_11 & 0xFFFF
    356          //      NLME_GetCoordExtAddr( coordextaddr );
    357          //      for(i=0;i<8;i++)
    358          //        Point_To_Point_DstAddr.addr.extAddr[i] = coordextaddr[i]; //发给协调器
    359                break;
    360              }
    361            case ESTABLISH_CONNECTION_RSQ:
    362              {
    363                if(ZigLightApp_NwkState == DEV_ZB_COORD){
   \                     ??SendData_load_1:
   \   000068   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   6409         XRL     A,#0x9
   \   00006E   70E7         JNZ     ??SendData_load_6
    364                  sbuf[0] = 0x01;
   \   000070   8A82         MOV     DPL,R2
   \   000072   8B83         MOV     DPH,R3
   \   000074   7401         MOV     A,#0x1
   \   000076   F0           MOVX    @DPTR,A
    365                  sbuf[1] = 1;//newdevice_joinin; // 根据链表空间大小处理 
   \   000077   A3           INC     DPTR
   \   000078   F0           MOVX    @DPTR,A
    366                  newdevice_joinin = 0;
   \   000079   90....       MOV     DPTR,#newdevice_joinin
   \   00007C   E4           CLR     A
   \   00007D   80E0         SJMP    ??SendData_load_10
    367                }
    368                else{
    369                  sbuf[0] = 0xff;
    370                  sbuf[1] = 0xff;
    371                }
    372                sbuf_len = 2;
    373                break;
    374              }
    375            case HEARTBEAT:
    376              {
    377                if(ZigLightApp_NwkState != DEV_ZB_COORD){
   \                     ??SendData_load_2:
   \   00007F   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000082   E0           MOVX    A,@DPTR
   \   000083   6409         XRL     A,#0x9
   \   000085   8A82         MOV     DPL,R2
   \   000087   8B83         MOV     DPH,R3
   \   000089   6004         JZ      ??SendData_load_12
    378                  sbuf[0] = 0x02;
   \   00008B   7402         MOV     A,#0x2
   \   00008D   8002         SJMP    ??SendData_load_13
    379                }
    380                else
    381                  sbuf[0] = 0xff;
   \                     ??SendData_load_12:
   \   00008F   74FF         MOV     A,#-0x1
   \                     ??SendData_load_13:
   \   000091   F0           MOVX    @DPTR,A
    382                sbuf_len = 1;
   \   000092   90....       MOV     DPTR,#sbuf_len
   \   000095   7401         MOV     A,#0x1
   \   000097   807F         SJMP    ??SendData_load_11
    383                break;
    384              }
    385            case DEVICE_STATUS_CHANGE:
    386              {
    387                if(ZigLightApp_NwkState != DEV_ZB_COORD){
   \                     ??SendData_load_3:
   \   000099   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   6409         XRL     A,#0x9
   \   00009F   8A82         MOV     DPL,R2
   \   0000A1   8B83         MOV     DPH,R3
   \   0000A3   6027         JZ      ??SendData_load_14
    388                  sbuf[0] = 0x04;
   \   0000A5   7404         MOV     A,#0x4
   \   0000A7   F0           MOVX    @DPTR,A
    389                  sbuf[1] = on_off;
   \   0000A8   90....       MOV     DPTR,#on_off
   \   0000AB   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   0000AE   F0           MOVX    @DPTR,A
    390                  sbuf[2] = white;
   \   0000AF   90....       MOV     DPTR,#white
   \   0000B2   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   0000B5   A3           INC     DPTR
   \   0000B6   F0           MOVX    @DPTR,A
    391                  sbuf[3] = red;
   \   0000B7   90....       MOV     DPTR,#red
   \   0000BA   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   0000BD   F0           MOVX    @DPTR,A
    392                  sbuf[4] = green;
   \   0000BE   90....       MOV     DPTR,#green
   \   0000C1   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   0000C4   A3           INC     DPTR
   \   0000C5   F0           MOVX    @DPTR,A
    393                  sbuf[5] = blue;
   \   0000C6   90....       MOV     DPTR,#blue
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   8013         SJMP    ??SendData_load_15
    394                }
    395                else{
    396                  sbuf[0] = 0xff;
   \                     ??SendData_load_14:
   \   0000CC   74FF         MOV     A,#-0x1
   \   0000CE   F0           MOVX    @DPTR,A
    397                  sbuf[1] = 0xff;
   \   0000CF   A3           INC     DPTR
   \   0000D0   F0           MOVX    @DPTR,A
    398                  sbuf[2] = 0xff;
   \   0000D1   8A82         MOV     DPL,R2
   \   0000D3   8B83         MOV     DPH,R3
   \   0000D5   A3           INC     DPTR
   \   0000D6   A3           INC     DPTR
   \   0000D7   12....       LCALL   ?Subroutine10 & 0xFFFF
    399                  sbuf[3] = 0xff;
   \                     ??CrossCallReturnLabel_12:
   \   0000DA   12....       LCALL   ?Subroutine10 & 0xFFFF
    400                  sbuf[4] = 0xff;
   \                     ??CrossCallReturnLabel_13:
   \   0000DD   A3           INC     DPTR
   \   0000DE   F0           MOVX    @DPTR,A
    401                  sbuf[5] = 0xff;
   \                     ??SendData_load_15:
   \   0000DF   8A82         MOV     DPL,R2
   \   0000E1   8B83         MOV     DPH,R3
   \   0000E3   A3           INC     DPTR
   \   0000E4   A3           INC     DPTR
   \   0000E5   A3           INC     DPTR
   \   0000E6   A3           INC     DPTR
   \   0000E7   A3           INC     DPTR
   \   0000E8   F0           MOVX    @DPTR,A
    402                }
    403                sbuf_len = 6;
   \                     ??SendData_load_16:
   \   0000E9   90....       MOV     DPTR,#sbuf_len
   \   0000EC   7406         MOV     A,#0x6
   \   0000EE   8028         SJMP    ??SendData_load_11
    404                break;
    405              }
    406            case DEVICE_COMMAND://未完成 ！！！！！！！！！！！！！！！
    407              {
    408                sbuf[0] = 0x05;
   \                     ??SendData_load_4:
   \   0000F0   8A82         MOV     DPL,R2
   \   0000F2   8B83         MOV     DPH,R3
   \   0000F4   7405         MOV     A,#0x5
   \   0000F6   F0           MOVX    @DPTR,A
    409                for(i=1;i<6;i++)
   \   0000F7   7C01         MOV     R4,#0x1
    410                  sbuf[i] = gizwits_buf[i];
   \                     ??SendData_load_17:
   \   0000F9   8C82         MOV     DPL,R4
   \   0000FB   A882         MOV     R0,DPL
   \   0000FD   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000100   E0           MOVX    A,@DPTR
   \   000101   C0E0         PUSH    A
   \   000103   EA           MOV     A,R2
   \   000104   28           ADD     A,R0
   \   000105   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_66:
   \   000108   D0E0         POP     A
   \   00010A   F0           MOVX    @DPTR,A
   \   00010B   0C           INC     R4
   \   00010C   EC           MOV     A,R4
   \   00010D   C3           CLR     C
   \   00010E   9406         SUBB    A,#0x6
   \   000110   50D7         JNC     ??SendData_load_16
   \   000112   80E5         SJMP    ??SendData_load_17
    411                sbuf_len = 6;
    412                break;
    413              }
    414            default:
    415              sbuf_len = 0;
   \                     ??SendData_load_5:
   \   000114   90....       MOV     DPTR,#sbuf_len
   \   000117   E4           CLR     A
   \                     ??SendData_load_11:
   \   000118   F0           MOVX    @DPTR,A
    416            }
    417            return sbuf_len;
   \   000119   E0           MOVX    A,@DPTR
   \   00011A   F9           MOV     R1,A
   \   00011B   D083         POP     DPH
   \   00011D   D082         POP     DPL
   \   00011F   02....       LJMP    ?BRET
    418          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine28:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   A3           INC     DPTR
   \   000006   A3           INC     DPTR
   \   000007   A3           INC     DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   74..         MOV     A,#gizwits_buf & 0xff
   \   000002   28           ADD     A,R0
   \   000003   F582         MOV     DPL,A
   \   000005   74..         MOV     A,#(gizwits_buf >> 8) & 0xff
   \   000007   3400         ADDC    A,#0x0
   \   000009   F583         MOV     DPH,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   F582         MOV     DPL,A
   \   000002   EB           MOV     A,R3
   \   000003                REQUIRE ??Subroutine33_0
   \   000003                ; // Fall through to label ??Subroutine33_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine33_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    419          void serial_data_handle(uint8 *ptr)
   \                     serial_data_handle:
    420          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    421            uint8 i;
    422            uint8 res;
    423            uint8 *serialMac;
    424            uint16 shortaddr;
    425            serialMac = &ptr[0];
    426            if(ZigLightApp_NwkState == DEV_ZB_COORD){
   \   00000E   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000011   E0           MOVX    A,@DPTR
   \   000012   6409         XRL     A,#0x9
   \   000014   6003         JZ      $+5
   \   000016   02....       LJMP    ??serial_data_handle_0 & 0xFFFF
    427              if(ptr[8] != 0x05){//cmdtype
   \   000019   8E82         MOV     DPL,R6
   \   00001B   8F83         MOV     DPH,R7
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \   000026   6405         XRL     A,#0x5
   \   000028   600F         JZ      ??serial_data_handle_1
    428                HalUARTWrite(0,"error cmd type\r",15);
   \   00002A                ; Setup parameters for call to function HalUARTWrite
   \   00002A   7C0F         MOV     R4,#0xf
   \   00002C   7D00         MOV     R5,#0x0
   \   00002E   7A..         MOV     R2,#`?<Constant "error cmd type\\r">` & 0xff
   \   000030   7B..         MOV     R3,#(`?<Constant "error cmd type\\r">` >> 8) & 0xff
   \                     ??serial_data_handle_2:
   \   000032   7900         MOV     R1,#0x0
   \   000034   12....       LCALL   ??HalUARTWrite?relay
    429                return;
   \   000037   806B         SJMP    ??serial_data_handle_0
    430              }
    431              main_state = DEVICE_COMMAND;
   \                     ??serial_data_handle_1:
   \   000039   90....       MOV     DPTR,#main_state
   \   00003C   7415         MOV     A,#0x15
   \   00003E   F0           MOVX    @DPTR,A
    432              res = APSME_LookupNwkAddr(serialMac , &shortaddr);
    433              if(res == false){
   \   00003F                ; Setup parameters for call to function APSME_LookupNwkAddr
   \   00003F   85..82       MOV     DPL,?XSP + 0
   \   000042   85..83       MOV     DPH,?XSP + 1
   \   000045   AC82         MOV     R4,DPL
   \   000047   AD83         MOV     R5,DPH
   \   000049   12....       LCALL   ??APSME_LookupNwkAddr?relay
   \   00004C   E9           MOV     A,R1
   \   00004D   700A         JNZ     ??serial_data_handle_3
    434                // 添加未找到设备回应信息
    435                HalUARTWrite(0,"can't find MAC device\r",22);
   \   00004F                ; Setup parameters for call to function HalUARTWrite
   \   00004F   7C16         MOV     R4,#0x16
   \   000051   7D00         MOV     R5,#0x0
   \   000053   7A..         MOV     R2,#`?<Constant "can\\'t find MAC device\\r">` & 0xff
   \   000055   7B..         MOV     R3,#(`?<Constant "can\\'t find MAC device\\r">` >> 8) & 0xff
   \   000057   80D9         SJMP    ??serial_data_handle_2
    436                return;
    437              }
    438              Point_To_Point_DstAddr.addr.shortAddr = shortaddr; //发给设备
   \                     ??serial_data_handle_3:
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   12....       LCALL   ?Subroutine27 & 0xFFFF
    439              for(i=0;i<6;i++)
   \                     ??CrossCallReturnLabel_49:
   \   000062   7A00         MOV     R2,#0x0
    440                gizwits_buf[i] = ptr[i+8];
   \                     ??serial_data_handle_4:
   \   000064   8A82         MOV     DPL,R2
   \   000066   A882         MOV     R0,DPL
   \   000068   EE           MOV     A,R6
   \   000069   28           ADD     A,R0
   \   00006A   F582         MOV     DPL,A
   \   00006C   EF           MOV     A,R7
   \   00006D   12....       LCALL   ??Subroutine33_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_63:
   \   000070   A3           INC     DPTR
   \   000071   A3           INC     DPTR
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   A3           INC     DPTR
   \   000076   A3           INC     DPTR
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   C0E0         PUSH    A
   \   00007B   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   00007E   D0E0         POP     A
   \   000080   F0           MOVX    @DPTR,A
   \   000081   0A           INC     R2
   \   000082   EA           MOV     A,R2
   \   000083   C3           CLR     C
   \   000084   9406         SUBB    A,#0x6
   \   000086   40DC         JC      ??serial_data_handle_4
    441              sbuf_len = SendData_load(sbuf);
   \   000088                ; Setup parameters for call to function SendData_load
   \   000088   12....       LCALL   ?Subroutine21 & 0xFFFF
    442              if(sbuf_len)
   \                     ??CrossCallReturnLabel_39:
   \   00008B   6017         JZ      ??serial_data_handle_0
    443                ZigLightApp_SendPointToPointMessage(&Point_To_Point_DstAddr,&ZigLightApp_epDesc,sbuf_len,sbuf);
   \   00008D                ; Setup parameters for call to function ZigLightApp_SendPointToPointMessage
   \   00008D   75....       MOV     ?V0 + 0,#sbuf & 0xff
   \   000090   75....       MOV     ?V0 + 1,#(sbuf >> 8) & 0xff
   \   000093   78..         MOV     R0,#?V0 + 0
   \   000095   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000098   12....       LCALL   ?Subroutine11 & 0xFFFF
    444            }
   \                     ??CrossCallReturnLabel_14:
   \   00009B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009E   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   0000A1   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??serial_data_handle_0:
   \   0000A4   7402         MOV     A,#0x2
   \   0000A6   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A9   7F02         MOV     R7,#0x2
   \   0000AB   02....       LJMP    ?BANKED_LEAVE_XDATA
    445          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_62:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine31:
   \   000000   7A..         MOV     R2,#sbuf & 0xff
   \   000002   7B..         MOV     R3,#(sbuf >> 8) & 0xff
   \   000004   12....       LCALL   ??SendData_load?relay
   \   000007   E9           MOV     A,R1
   \   000008   90....       MOV     DPTR,#sbuf_len
   \   00000B   F0           MOVX    @DPTR,A
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   7C..         MOV     R4,#ZigLightApp_epDesc & 0xff
   \   000002   7D..         MOV     R5,#(ZigLightApp_epDesc >> 8) & 0xff
   \   000004   7A..         MOV     R2,#Point_To_Point_DstAddr & 0xff
   \   000006   7B..         MOV     R3,#(Point_To_Point_DstAddr >> 8) & 0xff
   \   000008   12....       LCALL   ??ZigLightApp_SendPointToPointMessage?relay
   \   00000B   7404         MOV     A,#0x4
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   90....       MOV     DPTR,#sbuf_len
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F5..         MOV     ?V0 + 0,A
   \   000006   75..00       MOV     ?V0 + 1,#0x0
   \   000009   78..         MOV     R0,#?V0 + 0
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine27:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   90....       MOV     DPTR,#Point_To_Point_DstAddr
   \   000008   E8           MOV     A,R0
   \   000009   F0           MOVX    @DPTR,A
   \   00000A   A3           INC     DPTR
   \   00000B   E9           MOV     A,R1
   \   00000C   F0           MOVX    @DPTR,A
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    446          void ZigLightApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     ZigLightApp_ProcessZDOMsgs:
    447          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    448            uint8 i;
    449            uint16 temp;
    450            uint8 asc_16[16]={'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   AC82         MOV     R4,DPL
   \   000016   AD83         MOV     R5,DPH
   \   000018   7583..       MOV     DPH,#(`?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56` >> 8) & 0xff
   \   00001B   7582..       MOV     DPL,#`?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56` & 0xff
   \   00001E   7410         MOV     A,#0x10
   \   000020   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    451            Node *currentnode;
    452            switch ( inMsg->clusterID )
   \   000023   EA           MOV     A,R2
   \   000024   240C         ADD     A,#0xc
   \   000026   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_67:
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   6401         XRL     A,#0x1
   \   00002C   7004         JNZ     ??ZigLightApp_ProcessZDOMsgs_0
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6480         XRL     A,#0x80
   \                     ??ZigLightApp_ProcessZDOMsgs_0:
   \   000032   6003         JZ      $+5
   \   000034   02....       LJMP    ??ZigLightApp_ProcessZDOMsgs_1 & 0xFFFF
    453            {
    454              case IEEE_addr_rsp:
    455                {
    456                  // Send find device callback to application
    457                  ZDO_NwkIEEEAddrResp_t *pNwkAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \   000037                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000037   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   00003A   8A..         MOV     ?V0 + 2,R2
   \   00003C   8B..         MOV     ?V0 + 3,R3
   \   00003E   AE..         MOV     R6,?V0 + 2
   \   000040   AF..         MOV     R7,?V0 + 3
    458                  currentnode = searchfromList(nodelist,pNwkAddrRsp->extAddr);
   \   000042                ; Setup parameters for call to function searchfromList
   \   000042   EE           MOV     A,R6
   \   000043   2403         ADD     A,#0x3
   \   000045   FC           MOV     R4,A
   \   000046   EF           MOV     A,R7
   \   000047   3400         ADDC    A,#0x0
   \   000049   FD           MOV     R5,A
   \   00004A   90....       MOV     DPTR,#nodelist
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   FA           MOV     R2,A
   \   00004F   A3           INC     DPTR
   \   000050   E0           MOVX    A,@DPTR
   \   000051   FB           MOV     R3,A
   \   000052   12....       LCALL   ??searchfromList?relay
   \   000055   8A..         MOV     ?V0 + 2,R2
   \   000057   8B..         MOV     ?V0 + 3,R3
   \   000059   A8..         MOV     R0,?V0 + 2
   \   00005B   A9..         MOV     R1,?V0 + 3
    459                  if(currentnode == NULL)
   \   00005D   E8           MOV     A,R0
   \   00005E   49           ORL     A,R1
   \   00005F   7022         JNZ     ??ZigLightApp_ProcessZDOMsgs_2
    460                    newdevice_joinin = insertLastList(&nodelist,pNwkAddrRsp->extAddr,pNwkAddrRsp->nwkAddr);
   \   000061                ; Setup parameters for call to function insertLastList
   \   000061   8E82         MOV     DPL,R6
   \   000063   8F83         MOV     DPH,R7
   \   000065   A3           INC     DPTR
   \   000066   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000069   EE           MOV     A,R6
   \   00006A   2403         ADD     A,#0x3
   \   00006C   FC           MOV     R4,A
   \   00006D   EF           MOV     A,R7
   \   00006E   3400         ADDC    A,#0x0
   \   000070   FD           MOV     R5,A
   \   000071   7A..         MOV     R2,#nodelist & 0xff
   \   000073   7B..         MOV     R3,#(nodelist >> 8) & 0xff
   \   000075   12....       LCALL   ??insertLastList?relay
   \   000078   7402         MOV     A,#0x2
   \   00007A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007D   E9           MOV     A,R1
   \   00007E   90....       MOV     DPTR,#newdevice_joinin
   \   000081   800B         SJMP    ??ZigLightApp_ProcessZDOMsgs_3
    461                  else
    462                    currentnode->heartbeatCnt++;
   \                     ??ZigLightApp_ProcessZDOMsgs_2:
   \   000083   E8           MOV     A,R0
   \   000084   240B         ADD     A,#0xb
   \   000086   F582         MOV     DPL,A
   \   000088   E9           MOV     A,R1
   \   000089   12....       LCALL   ??Subroutine33_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_64:
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   04           INC     A
   \                     ??ZigLightApp_ProcessZDOMsgs_3:
   \   00008E   F0           MOVX    @DPTR,A
    463                  if(ZigLightApp_NwkState == DEV_ZB_COORD){
   \   00008F   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000092   E0           MOVX    A,@DPTR
   \   000093   6409         XRL     A,#0x9
   \   000095   7044         JNZ     ??ZigLightApp_ProcessZDOMsgs_1
    464                    /****将短地址分解，ASC码打印*****/
    465                    temp=pNwkAddrRsp->nwkAddr; //读出数据包的16位短地址
   \   000097   8E82         MOV     DPL,R6
   \   000099   8F83         MOV     DPH,R7
   \   00009B   12....       LCALL   ?Subroutine13 & 0xFFFF
    466                    HalUARTWrite(0,&asc_16[temp/4096],1);
   \                     ??CrossCallReturnLabel_22:
   \   00009E   8E..         MOV     ?V0 + 2,R6
   \   0000A0   8F..         MOV     ?V0 + 3,R7
   \   0000A2   740C         MOV     A,#0xc
   \   0000A4   78..         MOV     R0,#?V0 + 2
   \   0000A6   12....       LCALL   ?US_SHR
   \   0000A9   85..82       MOV     DPL,?XSP + 0
   \   0000AC   85..83       MOV     DPH,?XSP + 1
   \   0000AF   E582         MOV     A,DPL
   \   0000B1   25..         ADD     A,?V0 + 2
   \   0000B3   12....       LCALL   ?Subroutine3 & 0xFFFF
    467                    HalUARTWrite(0,&asc_16[temp%4096/256],1);
    468                    HalUARTWrite(0,&asc_16[temp%256/16],1);
    469                    HalUARTWrite(0,&asc_16[temp%16],1);  
    470                    HalUARTWrite(0,"\r\n",2);
   \                     ??CrossCallReturnLabel_0:
   \   0000B6                ; Setup parameters for call to function HalUARTWrite
   \   0000B6   7C02         MOV     R4,#0x2
   \   0000B8   7D00         MOV     R5,#0x0
   \   0000BA   7A..         MOV     R2,#`?<Constant "\\r\\n">` & 0xff
   \   0000BC   7B..         MOV     R3,#(`?<Constant "\\r\\n">` >> 8) & 0xff
   \   0000BE   12....       LCALL   ?Subroutine4 & 0xFFFF
    471                    main_state = ESTABLISH_CONNECTION_RSQ;//返回建立耸rsq
    472                    sbuf_len = SendData_load(sbuf);
    473                    if(sbuf_len){
   \                     ??CrossCallReturnLabel_58:
   \   0000C1   6018         JZ      ??ZigLightApp_ProcessZDOMsgs_1
    474                      Point_To_Point_DstAddr.addr.shortAddr = inMsg->srcAddr.addr.shortAddr;
   \   0000C3   85..82       MOV     DPL,?V0 + 0
   \   0000C6   85..83       MOV     DPH,?V0 + 1
   \   0000C9   12....       LCALL   ?Subroutine8 & 0xFFFF
    475                      ZigLightApp_SendPointToPointMessage(&Point_To_Point_DstAddr,&ZigLightApp_epDesc,sbuf_len,sbuf);//返回建立耸rsq
    476                    }
    477                  }
    478          //        ZDO_RemoveRegisteredCB(ZigLightApp_TaskID,IEEE_addr_rsp);
    479                  if(0)//uart test
    480                  {
    481                    HalUARTWrite(0,"\nA:",3);
    482                    for(i=0;i<8;i++)
    483                    {
    484                      HalUARTWrite(0,&asc_16[pNwkAddrRsp->extAddr[i]%256/16],1);
    485                      HalUARTWrite(0,&asc_16[pNwkAddrRsp->extAddr[i]%16],1);  
    486                    }
    487                    HalUARTWrite(0,"\n",1);
    488                  }
    489                }
    490                break;
    491            }
   \                     ??CrossCallReturnLabel_8:
   \   0000CC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CF   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   0000D2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D5   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   0000D8   12....       LCALL   ?DEALLOC_XSTACK8
    492          }
   \                     ??ZigLightApp_ProcessZDOMsgs_1:
   \   0000DB   7410         MOV     A,#0x10
   \   0000DD   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E0                REQUIRE ?Subroutine0
   \   0000E0                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7900         MOV     R1,#0x0
   \   000002   12....       LCALL   ??HalUARTWrite?relay
   \   000005   90....       MOV     DPTR,#main_state
   \   000008   7412         MOV     A,#0x12
   \   00000A                REQUIRE ??Subroutine32_0
   \   00000A                ; // Fall through to label ??Subroutine32_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine32_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function SendData_load
   \   000001                ; Setup parameters for call to function SendData_load
   \   000001                ; Setup parameters for call to function SendData_load
   \   000001   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_61:
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   A3           INC     DPTR
   \   000001   E0           MOVX    A,@DPTR
   \   000002   FE           MOV     R6,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   FF           MOV     R7,A
   \   000006                ; Setup parameters for call to function HalUARTWrite
   \   000006                ; Setup parameters for call to function HalUARTWrite
   \   000006   7C01         MOV     R4,#0x1
   \   000008   7D00         MOV     R5,#0x0
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   A3           INC     DPTR
   \   000001   A3           INC     DPTR
   \   000002   12....       LCALL   ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000005                ; Setup parameters for call to function ZigLightApp_SendPointToPointMessage
   \   000005                ; Setup parameters for call to function ZigLightApp_SendPointToPointMessage
   \   000005   75....       MOV     ?V0 + 0,#sbuf & 0xff
   \   000008   75....       MOV     ?V0 + 1,#(sbuf >> 8) & 0xff
   \   00000B   78..         MOV     R0,#?V0 + 0
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_71:
   \   000003   EF           MOV     A,R7
   \   000004   F9           MOV     R1,A
   \   000005   E4           CLR     A
   \   000006   C9           XCH     A,R1
   \   000007   12....       LCALL   ?Subroutine30 & 0xFFFF
   \                     ??CrossCallReturnLabel_56:
   \   00000A   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_47:
   \   00000D   C4           SWAP    A
   \   00000E   12....       LCALL   ?Subroutine30 & 0xFFFF
   \                     ??CrossCallReturnLabel_57:
   \   000011   7900         MOV     R1,#0x0
   \   000013   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   000016   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_55:
   \   000019   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine30:
   \   000000   540F         ANL     A,#0xf
   \   000002   F8           MOV     R0,A
   \   000003   85..82       MOV     DPL,?XSP + 0
   \   000006   85..83       MOV     DPH,?XSP + 1
   \   000009   E582         MOV     A,DPL
   \   00000B   28           ADD     A,R0
   \   00000C   FA           MOV     R2,A
   \   00000D   E583         MOV     A,DPH
   \   00000F   3400         ADDC    A,#0x0
   \   000011   FB           MOV     R3,A
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine29:
   \   000000   540F         ANL     A,#0xf
   \   000002   F8           MOV     R0,A
   \   000003   7900         MOV     R1,#0x0
   \   000005   85..82       MOV     DPL,?XSP + 0
   \   000008   85..83       MOV     DPH,?XSP + 1
   \   00000B   E582         MOV     A,DPL
   \   00000D   28           ADD     A,R0
   \   00000E   FA           MOV     R2,A
   \   00000F   E583         MOV     A,DPH
   \   000011   3400         ADDC    A,#0x0
   \   000013   FB           MOV     R3,A
   \   000014   12....       LCALL   ??HalUARTWrite?relay
   \   000017   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine34_0:
   \   000000   FA           MOV     R2,A
   \   000001   E583         MOV     A,DPH
   \   000003   3400         ADDC    A,#0x0
   \   000005   FB           MOV     R3,A
   \   000006                REQUIRE ??Subroutine35_0
   \   000006                ; // Fall through to label ??Subroutine35_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine35_0:
   \   000000   7900         MOV     R1,#0x0
   \   000002   12....       LCALL   ??HalUARTWrite?relay
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005                ; Setup parameters for call to function HalUARTWrite
   \   000005   7C01         MOV     R4,#0x1
   \   000007   7D00         MOV     R5,#0x0
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine25:
   \   000000   12....       LCALL   ??HalUARTWrite?relay
   \   000003                ; Setup parameters for call to function HalUARTWrite
   \   000003                ; Setup parameters for call to function HalUARTWrite
   \   000003                ; Setup parameters for call to function HalUARTWrite
   \   000003                ; Setup parameters for call to function HalUARTWrite
   \   000003   7C01         MOV     R4,#0x1
   \   000005   7D00         MOV     R5,#0x0
   \   000007   EE           MOV     A,R6
   \   000008   22           RET
    493          /***********************************end by liu*****************************************/
    494          /*********************************************************************
    495           * @fn      ZigLightApp_ProcessEvent
    496           *
    497           * @brief   Generic Application Task event processor.  This function
    498           *          is called to process all events for the task.  Events
    499           *          include timers, messages and any other user defined events.
    500           *
    501           * @param   task_id  - The OSAL assigned task ID.
    502           * @param   events - events to process.  This is a bit map and can
    503           *                   contain more than one event.
    504           *
    505           * @return  none
    506           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    507          uint16 ZigLightApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     ZigLightApp_ProcessEvent:
    508          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    509            afIncomingMSGPacket_t *MSGpkt;
    510          //  uint8 *msg_ptr;//by liu
    511          //  uint8 i;//by liu
    512            (void)task_id;  // Intentionally unreferenced parameter
    513          
    514            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL     A,#0x80
   \   00000B   7003         JNZ     $+5
   \   00000D   02....       LJMP    ??ZigLightApp_ProcessEvent_0 & 0xFFFF
    515            {
    516              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( ZigLightApp_TaskID );
   \   000010                ; Setup parameters for call to function osal_msg_receive
   \   000010   8024         SJMP    ??ZigLightApp_ProcessEvent_1
    517              while ( MSGpkt )
    518              {
    519                switch ( MSGpkt->hdr.event )
    520                {
    521                  case ZDO_CB_MSG:
    522                    ZigLightApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    523                    break;
    524                  // Received when a key is pressed
    525                  case KEY_CHANGE:
    526                    ZigLightApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    527                    break;
    528          
    529                  // Received when a messages is received (OTA) for this endpoint
    530                  case AF_INCOMING_MSG_CMD:
    531                    ZigLightApp_MessageMSGCB( MSGpkt );
    532                    break;
    533          
    534                  // Received whenever the device changes state in the network
    535                  case ZDO_STATE_CHANGE:
    536                    ZigLightApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    537          //          if ( //(ZigLightApp_NwkState == DEV_ZB_COORD)|| //协调器不给自己点播
    538          //               (ZigLightApp_NwkState == DEV_ROUTER)
    539          //              || (ZigLightApp_NwkState == DEV_END_DEVICE) )
    540          //          {
    541                      // Start sending the periodic message in a regular interval.
    542                      osal_start_timerEx( ZigLightApp_TaskID,
    543                                        ZigLightApp_SEND_PERIODIC_MSG_EVT,
    544                                        ZigLightApp_SEND_PERIODIC_MSG_TIMEOUT );
    545          //          }
    546          //          else
    547          //          {
    548          //            // Device is no longer in the network
    549          //          }
    550                    break;
    551                  case SPI_INCOMING_ZTOOL_PORT:
    552                    HalUARTWrite(0,"ZTOOL\r",6);
    553                    break;
    554                  case SERIAL_INCOMING_MSG:
    555                    HalUARTWrite(0,"SERIAL\r",7);
   \                     ??ZigLightApp_ProcessEvent_2:
   \   000012                ; Setup parameters for call to function HalUARTWrite
   \   000012   7C07         MOV     R4,#0x7
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A..         MOV     R2,#`?<Constant "SERIAL\\r">` & 0xff
   \   000018   7B..         MOV     R3,#(`?<Constant "SERIAL\\r">` >> 8) & 0xff
   \   00001A   7900         MOV     R1,#0x0
   \   00001C   12....       LCALL   ??HalUARTWrite?relay
    556                    serial_data_handle(((mtOSALSerialData_t *)MSGpkt)->msg);
   \   00001F                ; Setup parameters for call to function serial_data_handle
   \   00001F   85..82       MOV     DPL,?V0 + 0
   \   000022   85..83       MOV     DPH,?V0 + 1
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \   000028   FA           MOV     R2,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   FB           MOV     R3,A
   \   00002C   12....       LCALL   ??serial_data_handle?relay
    557          
    558                    break;
    559                  default:
    560                    break;
    561                }
    562          
    563                // Release the memory
    564                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??ZigLightApp_ProcessEvent_3:
   \   00002F                ; Setup parameters for call to function osal_msg_deallocate
   \   00002F   AA..         MOV     R2,?V0 + 0
   \   000031   AB..         MOV     R3,?V0 + 1
   \   000033   12....       LCALL   ??osal_msg_deallocate?relay
    565          
    566                // Next - if one is available
    567                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( ZigLightApp_TaskID );
   \   000036                ; Setup parameters for call to function osal_msg_receive
   \                     ??ZigLightApp_ProcessEvent_1:
   \   000036   90....       MOV     DPTR,#ZigLightApp_TaskID
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   F9           MOV     R1,A
   \   00003B   12....       LCALL   ??osal_msg_receive?relay
   \   00003E   8A..         MOV     ?V0 + 0,R2
   \   000040   8B..         MOV     ?V0 + 1,R3
   \   000042   E5..         MOV     A,?V0 + 0
   \   000044   45..         ORL     A,?V0 + 1
   \   000046   6060         JZ      ??ZigLightApp_ProcessEvent_4
   \   000048   85..82       MOV     DPL,?V0 + 0
   \   00004B   85..83       MOV     DPH,?V0 + 1
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   24E6         ADD     A,#-0x1a
   \   000051   6033         JZ      ??ZigLightApp_ProcessEvent_5
   \   000053   24F9         ADD     A,#-0x7
   \   000055   6042         JZ      ??ZigLightApp_ProcessEvent_6
   \   000057   2461         ADD     A,#0x61
   \   000059   6017         JZ      ??ZigLightApp_ProcessEvent_7
   \   00005B   24EF         ADD     A,#-0x11
   \   00005D   6030         JZ      ??ZigLightApp_ProcessEvent_8
   \   00005F   24FE         ADD     A,#-0x2
   \   000061   6006         JZ      ??ZigLightApp_ProcessEvent_9
   \   000063   24F2         ADD     A,#-0xe
   \   000065   60AB         JZ      ??ZigLightApp_ProcessEvent_2
   \   000067   80C6         SJMP    ??ZigLightApp_ProcessEvent_3
   \                     ??ZigLightApp_ProcessEvent_9:
   \   000069                ; Setup parameters for call to function ZigLightApp_ProcessZDOMsgs
   \   000069   AA..         MOV     R2,?V0 + 0
   \   00006B   AB..         MOV     R3,?V0 + 1
   \   00006D   12....       LCALL   ??ZigLightApp_ProcessZDOMsgs?relay
   \   000070   80BD         SJMP    ??ZigLightApp_ProcessEvent_3
   \                     ??ZigLightApp_ProcessEvent_7:
   \   000072                ; Setup parameters for call to function ZigLightApp_HandleKeys
   \   000072   A3           INC     DPTR
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   FA           MOV     R2,A
   \   000077   85..82       MOV     DPL,?V0 + 0
   \   00007A   85..83       MOV     DPH,?V0 + 1
   \   00007D   A3           INC     DPTR
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   F9           MOV     R1,A
   \   000081   12....       LCALL   ??ZigLightApp_HandleKeys?relay
   \   000084   80A9         SJMP    ??ZigLightApp_ProcessEvent_3
   \                     ??ZigLightApp_ProcessEvent_5:
   \   000086                ; Setup parameters for call to function ZigLightApp_MessageMSGCB
   \   000086   AA..         MOV     R2,?V0 + 0
   \   000088   AB..         MOV     R3,?V0 + 1
   \   00008A   12....       LCALL   ??ZigLightApp_MessageMSGCB?relay
   \   00008D   80A0         SJMP    ??ZigLightApp_ProcessEvent_3
   \                     ??ZigLightApp_ProcessEvent_8:
   \   00008F   A3           INC     DPTR
   \   000090   E0           MOVX    A,@DPTR
   \   000091   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000094   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000097   8096         SJMP    ??ZigLightApp_ProcessEvent_3
   \                     ??ZigLightApp_ProcessEvent_6:
   \   000099                ; Setup parameters for call to function HalUARTWrite
   \   000099   7C06         MOV     R4,#0x6
   \   00009B   7D00         MOV     R5,#0x0
   \   00009D   7A..         MOV     R2,#`?<Constant "ZTOOL\\r">` & 0xff
   \   00009F   7B..         MOV     R3,#(`?<Constant "ZTOOL\\r">` >> 8) & 0xff
   \   0000A1   7900         MOV     R1,#0x0
   \   0000A3   12....       LCALL   ??HalUARTWrite?relay
   \   0000A6   8087         SJMP    ??ZigLightApp_ProcessEvent_3
    568              }
    569          
    570              // return unprocessed events
    571              return (events ^ SYS_EVENT_MSG);
   \                     ??ZigLightApp_ProcessEvent_4:
   \   0000A8   EE           MOV     A,R6
   \   0000A9   FA           MOV     R2,A
   \   0000AA   EF           MOV     A,R7
   \   0000AB   6480         XRL     A,#0x80
   \                     ??ZigLightApp_ProcessEvent_10:
   \   0000AD   FB           MOV     R3,A
   \   0000AE   02....       LJMP    ??ZigLightApp_ProcessEvent_11 & 0xFFFF
    572            }
    573          
    574            // Send a message out - This event is generated by a timer
    575            //  (setup in ZigLightApp_Init()).
    576            if ( events & ZigLightApp_SEND_PERIODIC_MSG_EVT )
   \                     ??ZigLightApp_ProcessEvent_0:
   \   0000B1   EE           MOV     A,R6
   \   0000B2   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000B4   507C         JNC     ??ZigLightApp_ProcessEvent_12
    577            {
    578              if(ZigLightApp_NwkState == DEV_ZB_COORD){
   \   0000B6   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   6409         XRL     A,#0x9
   \   0000BC   7015         JNZ     ??ZigLightApp_ProcessEvent_13
    579                if(MacToAppFlag == 0 && AutoUpateMac == 0){//在读取mac时禁止链表操作
   \   0000BE   90....       MOV     DPTR,#MacToAppFlag
   \   0000C1   E0           MOVX    A,@DPTR
   \   0000C2   7050         JNZ     ??ZigLightApp_ProcessEvent_14
   \   0000C4   90....       MOV     DPTR,#AutoUpateMac
   \   0000C7   E0           MOVX    A,@DPTR
   \   0000C8   704A         JNZ     ??ZigLightApp_ProcessEvent_14
    580                  detectHandle(&nodelist);
   \   0000CA                ; Setup parameters for call to function detectHandle
   \   0000CA   7A..         MOV     R2,#nodelist & 0xff
   \   0000CC   7B..         MOV     R3,#(nodelist >> 8) & 0xff
   \   0000CE   12....       LCALL   ??detectHandle?relay
   \   0000D1   8026         SJMP    ??ZigLightApp_ProcessEvent_15
    581                }
    582              }
    583              else if(ZigLightApp_NwkState == DEV_ROUTER || ZigLightApp_NwkState == DEV_END_DEVICE ){
   \                     ??ZigLightApp_ProcessEvent_13:
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   6407         XRL     A,#0x7
   \   0000D6   6005         JZ      ??ZigLightApp_ProcessEvent_16
   \   0000D8   E0           MOVX    A,@DPTR
   \   0000D9   6406         XRL     A,#0x6
   \   0000DB   7024         JNZ     ??ZigLightApp_ProcessEvent_17
    584                // Send the periodic message
    585          //      if(main_state != ESTABLISH_CONNECTION_REQ)
    586          //        return (events ^ ZigLightApp_SEND_PERIODIC_MSG_EVT);
    587                sbuf_len = SendData_load(sbuf);
   \                     ??ZigLightApp_ProcessEvent_16:
   \   0000DD                ; Setup parameters for call to function SendData_load
   \   0000DD   12....       LCALL   ?Subroutine21 & 0xFFFF
    588                if(sbuf_len)
   \                     ??CrossCallReturnLabel_40:
   \   0000E0   6017         JZ      ??ZigLightApp_ProcessEvent_15
    589                  ZigLightApp_SendPointToPointMessage(&Point_To_Point_DstAddr,&ZigLightApp_epDesc,sbuf_len,sbuf);
   \   0000E2                ; Setup parameters for call to function ZigLightApp_SendPointToPointMessage
   \   0000E2   75....       MOV     ?V0 + 0,#sbuf & 0xff
   \   0000E5   75....       MOV     ?V0 + 1,#(sbuf >> 8) & 0xff
   \   0000E8   78..         MOV     R0,#?V0 + 0
   \   0000EA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000ED   12....       LCALL   ?Subroutine11 & 0xFFFF
    590              }
   \                     ??CrossCallReturnLabel_16:
   \   0000F0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F3   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   0000F6   12....       LCALL   ?DEALLOC_XSTACK8
    591              if(ZigLightApp_NwkState != DEV_ZB_COORD){
   \                     ??ZigLightApp_ProcessEvent_15:
   \   0000F9   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   6409         XRL     A,#0x9
   \   0000FF   6013         JZ      ??ZigLightApp_ProcessEvent_14
    592                if(main_state == HEARTBEAT){
   \                     ??ZigLightApp_ProcessEvent_17:
   \   000101   90....       MOV     DPTR,#main_state
   \   000104   E0           MOVX    A,@DPTR
   \   000105   6413         XRL     A,#0x13
   \   000107   600B         JZ      ??ZigLightApp_ProcessEvent_14
    593                  // Setup to send message again in normal period (+ a little jitter)
    594                  osal_start_timerEx( ZigLightApp_TaskID, ZigLightApp_SEND_PERIODIC_MSG_EVT,
    595                      (ZigLightApp_SEND_HEARTBEAT_MSG_TIMEOUT + (osal_rand() & 0x0FFF)) );
   \   000109                ; Setup parameters for call to function osal_rand
    596                }
    597                else{
    598                  // Setup to send message again in normal period (+ a little jitter)
    599                  osal_start_timerEx( ZigLightApp_TaskID, ZigLightApp_SEND_PERIODIC_MSG_EVT,
    600                      (ZigLightApp_SEND_INIT_REQUEST_MSG_TIMEOUT + (osal_rand() & 0x0FFF)) );
   \   000109                ; Setup parameters for call to function osal_rand
   \   000109   12....       LCALL   ?Subroutine23 & 0xFFFF
    601                }
    602              }
   \                     ??CrossCallReturnLabel_43:
   \   00010C   24E8         ADD     A,#-0x18
   \   00010E   FC           MOV     R4,A
   \   00010F   E9           MOV     A,R1
   \   000110   3403         ADDC    A,#0x3
   \   000112   8009         SJMP    ??ZigLightApp_ProcessEvent_18
    603              else{
    604                  // Setup to send message again in normal period (+ a little jitter)
    605                  osal_start_timerEx( ZigLightApp_TaskID, ZigLightApp_SEND_PERIODIC_MSG_EVT,
    606                      (ZigLightApp_SEND_HEARTBEAT_MSG_TIMEOUT + (osal_rand() & 0x0FFF)) );
   \                     ??ZigLightApp_ProcessEvent_14:
   \   000114                ; Setup parameters for call to function osal_rand
   \   000114   12....       LCALL   ?Subroutine23 & 0xFFFF
    607              }
   \                     ??CrossCallReturnLabel_44:
   \   000117   2410         ADD     A,#0x10
   \   000119   FC           MOV     R4,A
   \   00011A   E9           MOV     A,R1
   \   00011B   3427         ADDC    A,#0x27
   \                     ??ZigLightApp_ProcessEvent_18:
   \   00011D   FD           MOV     R5,A
   \   00011E   7A01         MOV     R2,#0x1
   \   000120   7B00         MOV     R3,#0x0
   \   000122   90....       MOV     DPTR,#ZigLightApp_TaskID
   \   000125   E0           MOVX    A,@DPTR
   \   000126   F9           MOV     R1,A
   \   000127   12....       LCALL   ??osal_start_timerEx?relay
    608              // return unprocessed events
    609              return (events ^ ZigLightApp_SEND_PERIODIC_MSG_EVT);
   \   00012A   EE           MOV     A,R6
   \   00012B   6401         XRL     A,#0x1
   \   00012D   FA           MOV     R2,A
   \   00012E   EF           MOV     A,R7
   \   00012F   02....       LJMP    ??ZigLightApp_ProcessEvent_10 & 0xFFFF
    610            }
    611          
    612            // Discard unknown events
    613            return 0;
   \                     ??ZigLightApp_ProcessEvent_12:
   \   000132   7A00         MOV     R2,#0x0
   \   000134   7B00         MOV     R3,#0x0
   \                     ??ZigLightApp_ProcessEvent_11:
   \   000136   02....       LJMP    ?Subroutine0 & 0xFFFF
    614          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   12....       LCALL   ??osal_rand?relay
   \   000003                ; Setup parameters for call to function osal_start_timerEx
   \   000003                ; Setup parameters for call to function osal_start_timerEx
   \   000003   EA           MOV     A,R2
   \   000004   F8           MOV     R0,A
   \   000005   EB           MOV     A,R3
   \   000006   540F         ANL     A,#0xf
   \   000008   F9           MOV     R1,A
   \   000009   E8           MOV     A,R0
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001                ; Setup parameters for call to function osal_start_timerEx
   \   000001   7CB8         MOV     R4,#-0x48
   \   000003   7D0B         MOV     R5,#0xb
   \   000005   7A01         MOV     R2,#0x1
   \   000007   7B00         MOV     R3,#0x0
   \   000009   90....       MOV     DPTR,#ZigLightApp_TaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_start_timerEx?relay
   \   000011   22           RET
    615          
    616          /*********************************************************************
    617           * Event Generation Functions
    618           */
    619          /*********************************************************************
    620           * @fn      ZigLightApp_HandleKeys
    621           *
    622           * @brief   Handles all key events for this device.
    623           *
    624           * @param   shift - true if in shift/alt.
    625           * @param   keys - bit field for key events. Valid entries:
    626           *                 HAL_KEY_SW_2
    627           *                 HAL_KEY_SW_1
    628           *
    629           * @return  none
    630           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    631          void ZigLightApp_HandleKeys( uint8 shift, uint8 keys )
   \                     ZigLightApp_HandleKeys:
    632          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
    633            (void)shift;  // Intentionally unreferenced parameter
    634            if ( keys & HAL_KEY_GIZWIT )
   \   000006   A2E5         MOV     C,0xE0 /* A   */.5
   \   000008   5005         JNC     ??ZigLightApp_HandleKeys_0
    635            {
    636              gizwitsSetMode(WIFI_AIRLINK_MODE);//airlink
   \   00000A                ; Setup parameters for call to function gizwitsSetMode
   \   00000A   7902         MOV     R1,#0x2
   \   00000C   12....       LCALL   ??gizwitsSetMode?relay
    637          //    HalLedBlink( HAL_LED_1, 20, 50, 1000 );
    638            }
    639            //by liu
    640          //  if ( keys & HAL_KEY_SW_1 )
    641          //  {
    642          //    /* This key sends the Flash Command is sent to Group 1.
    643          //     * This device will not receive the Flash Command from this
    644          //     * device (even if it belongs to group 1).
    645          //     */
    646          //    ZigLightApp_SendFlashMessage( ZigLightApp_FLASH_DURATION );
    647          //  }
    648          //
    649          //  if ( keys & HAL_KEY_SW_2 )
    650          //  {
    651          //    /* The Flashr Command is sent to Group 1.
    652          //     * This key toggles this device in and out of group 1.
    653          //     * If this device doesn't belong to group 1, this application
    654          //     * will not receive the Flash command sent to group 1.
    655          //     */
    656          //    aps_Group_t *grp;
    657          //    grp = aps_FindGroup( ZigLightApp_ENDPOINT, ZigLightApp_FLASH_GROUP );
    658          //    if ( grp )
    659          //    {
    660          //      // Remove from the group
    661          //      aps_RemoveGroup( ZigLightApp_ENDPOINT, ZigLightApp_FLASH_GROUP );
    662          //    }
    663          //    else
    664          //    {
    665          //      // Add to the flash group
    666          //      aps_AddGroup( ZigLightApp_ENDPOINT, &ZigLightApp_Group );
    667          //    }
    668          //  }
    669          }
   \                     ??ZigLightApp_HandleKeys_0:
   \   00000F                REQUIRE ?Subroutine1
   \   00000F                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    670          /**********************************
    671          * add by liu 
    672          *************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    673          void rfdata_handle( afIncomingMSGPacket_t *pkt )
   \                     rfdata_handle:
    674          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 4,R2
   \   00000C   8B..         MOV     ?V0 + 5,R3
    675            uint8 asc_16[16]={'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   AC82         MOV     R4,DPL
   \   000016   AD83         MOV     R5,DPH
   \   000018   7583..       MOV     DPH,#(`?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56_1` >> 8) & 0xff
   \   00001B   7582..       MOV     DPL,#`?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56_1` & 0xff
   \   00001E   7410         MOV     A,#0x10
   \   000020   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    676            uint8 i;
    677            uint16 temp;
    678            switch(pkt->cmd.Data[0]){
   \   000023   EA           MOV     A,R2
   \   000024   2422         ADD     A,#0x22
   \   000026   F582         MOV     DPL,A
   \   000028   EB           MOV     A,R3
   \   000029   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   00002C   F583         MOV     DPH,A
   \   00002E   8882         MOV     DPL,R0
   \   000030   E0           MOVX    A,@DPTR
   \   000031   601C         JZ      ??rfdata_handle_0
   \   000033   14           DEC     A
   \   000034   7003         JNZ     $+5
   \   000036   02....       LJMP    ??rfdata_handle_1 & 0xFFFF
   \   000039   14           DEC     A
   \   00003A   7003         JNZ     $+5
   \   00003C   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
   \   00003F   24FE         ADD     A,#-0x2
   \   000041   7003         JNZ     $+5
   \   000043   02....       LJMP    ??rfdata_handle_3 & 0xFFFF
   \   000046   14           DEC     A
   \   000047   7003         JNZ     $+5
   \   000049   02....       LJMP    ??rfdata_handle_4 & 0xFFFF
   \   00004C   02....       LJMP    ??rfdata_handle_5 & 0xFFFF
    679            case 0://接收到建立耸req
    680              {
    681                if(ZigLightApp_NwkState == DEV_ZB_COORD){
   \                     ??rfdata_handle_0:
   \   00004F   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000052   E0           MOVX    A,@DPTR
   \   000053   6409         XRL     A,#0x9
   \   000055   6003         JZ      $+5
   \   000057   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    682                  HalUARTWrite(0,"\nR",2);
   \   00005A                ; Setup parameters for call to function HalUARTWrite
   \   00005A   7C02         MOV     R4,#0x2
   \   00005C   7D00         MOV     R5,#0x0
   \   00005E   7A..         MOV     R2,#`?<Constant "\\nR">` & 0xff
   \   000060   7B..         MOV     R3,#(`?<Constant "\\nR">` >> 8) & 0xff
   \   000062   12....       LCALL   ??Subroutine35_0 & 0xFFFF
    683                  HalUARTWrite(0,&asc_16[pkt->cmd.Data[1]],1);  
   \                     ??CrossCallReturnLabel_72:
   \   000065   E5..         MOV     A,?V0 + 4
   \   000067   2422         ADD     A,#0x22
   \   000069   F582         MOV     DPL,A
   \   00006B   E5..         MOV     A,?V0 + 5
   \   00006D   12....       LCALL   ??Subroutine33_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_65:
   \   000070   E0           MOVX    A,@DPTR
   \   000071   F8           MOV     R0,A
   \   000072   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000075   12....       LCALL   ?Subroutine26 & 0xFFFF
    684                  HalUARTWrite(0,"S",1);
   \                     ??CrossCallReturnLabel_69:
   \   000078   7A..         MOV     R2,#`?<Constant "S">` & 0xff
   \   00007A   7B..         MOV     R3,#(`?<Constant "S">` >> 8) & 0xff
   \   00007C   7900         MOV     R1,#0x0
   \   00007E   12....       LCALL   ??HalUARTWrite?relay
    685                    /****将短地址分解，ASC码打印*****/
    686                  temp=pkt->srcAddr.addr.shortAddr; //读出数据包的16位短地址
   \   000081   85..82       MOV     DPL,?V0 + 4
   \   000084   85..83       MOV     DPH,?V0 + 5
   \   000087   A3           INC     DPTR
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   A3           INC     DPTR
   \   00008B   A3           INC     DPTR
   \   00008C   12....       LCALL   ?Subroutine13 & 0xFFFF
    687                  HalUARTWrite(0,&asc_16[temp/4096],1);
   \                     ??CrossCallReturnLabel_23:
   \   00008F   8E..         MOV     ?V0 + 0,R6
   \   000091   8F..         MOV     ?V0 + 1,R7
   \   000093   740C         MOV     A,#0xc
   \   000095   78..         MOV     R0,#?V0 + 0
   \   000097   12....       LCALL   ?US_SHR
   \   00009A   85..82       MOV     DPL,?XSP + 0
   \   00009D   85..83       MOV     DPH,?XSP + 1
   \   0000A0   E582         MOV     A,DPL
   \   0000A2   25..         ADD     A,?V0 + 0
   \   0000A4   12....       LCALL   ?Subroutine3 & 0xFFFF
    688                  HalUARTWrite(0,&asc_16[temp%4096/256],1);
    689                  HalUARTWrite(0,&asc_16[temp%256/16],1);
    690                  HalUARTWrite(0,&asc_16[temp%16],1);  
    691                  HalUARTWrite(0,"\n",1);
   \                     ??CrossCallReturnLabel_1:
   \   0000A7                ; Setup parameters for call to function HalUARTWrite
   \   0000A7   7C01         MOV     R4,#0x1
   \   0000A9   7D00         MOV     R5,#0x0
   \   0000AB   7A..         MOV     R2,#`?<Constant "\\n">` & 0xff
   \   0000AD   7B..         MOV     R3,#(`?<Constant "\\n">` >> 8) & 0xff
   \   0000AF   12....       LCALL   ?Subroutine4 & 0xFFFF
    692                  main_state = ESTABLISH_CONNECTION_RSQ;//返回建立耸rsq
    693                  sbuf_len = SendData_load(sbuf);
    694                  if(sbuf_len){
   \                     ??CrossCallReturnLabel_59:
   \   0000B2   7003         JNZ     $+5
   \   0000B4   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    695                    Point_To_Point_DstAddr.addr.shortAddr = pkt->srcAddr.addr.shortAddr;
   \   0000B7   85..82       MOV     DPL,?V0 + 4
   \   0000BA   85..83       MOV     DPH,?V0 + 5
   \   0000BD   A3           INC     DPTR
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   12....       LCALL   ?Subroutine8 & 0xFFFF
    696                    ZigLightApp_SendPointToPointMessage(&Point_To_Point_DstAddr,&ZigLightApp_epDesc,sbuf_len,sbuf);//返回建立耸rsq
    697                  }
    698                }
    699                break;
    700              }
   \                     ??CrossCallReturnLabel_9:
   \   0000C4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C7   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   0000CA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CD   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   0000D0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D3   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    701            case 1://接收到建立耸rsq
    702              {
    703                if(ZigLightApp_NwkState != DEV_ZB_COORD){
   \                     ??rfdata_handle_1:
   \   0000D6   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   0000D9   E0           MOVX    A,@DPTR
   \   0000DA   6409         XRL     A,#0x9
   \   0000DC   7003         JNZ     $+5
   \   0000DE   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    704                  if(pkt->cmd.Data[1] == 1){//成功加入f{器 _始l送心跳包
   \   0000E1   EA           MOV     A,R2
   \   0000E2   2422         ADD     A,#0x22
   \   0000E4   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_68:
   \   0000E7   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   0000EA   6401         XRL     A,#0x1
   \   0000EC   6003         JZ      $+5
   \   0000EE   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    705                    main_state = HEARTBEAT;
   \   0000F1   90....       MOV     DPTR,#main_state
   \   0000F4   7413         MOV     A,#0x13
   \   0000F6   F0           MOVX    @DPTR,A
   \   0000F7   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    706                  }
    707                }
    708                break;
    709              }
    710            case 2://接收到心跳包
    711              {
    712                //nothing to do 
    713                break;
    714              }
    715            case 4://接收到OB改信
    716              {
    717                if(ZigLightApp_NwkState == DEV_ZB_COORD){
   \                     ??rfdata_handle_3:
   \   0000FA   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   6409         XRL     A,#0x9
   \   000100   6003         JZ      $+5
   \   000102   02....       LJMP    ??rfdata_handle_2 & 0xFFFF
    718                // update to gizwit
    719                  HalUARTWrite(0,"stat:",5);
   \   000105                ; Setup parameters for call to function HalUARTWrite
   \   000105   7C05         MOV     R4,#0x5
   \   000107   7D00         MOV     R5,#0x0
   \   000109   7A..         MOV     R2,#`?<Constant "stat:">` & 0xff
   \   00010B   7B..         MOV     R3,#(`?<Constant "stat:">` >> 8) & 0xff
   \   00010D   7900         MOV     R1,#0x0
   \   00010F   12....       LCALL   ??HalUARTWrite?relay
    720                  for(i=0;i<8;i++){
   \   000112   75..00       MOV     ?V0 + 2,#0x0
    721                    HalUARTWrite(0,&asc_16[(currentMac[i])>>4],1);  
   \                     ??rfdata_handle_6:
   \   000115   85....       MOV     ?V0 + 0,?V0 + 2
   \   000118   74..         MOV     A,#currentMac & 0xff
   \   00011A   25..         ADD     A,?V0 + 0
   \   00011C   FE           MOV     R6,A
   \   00011D   74..         MOV     A,#(currentMac >> 8) & 0xff
   \   00011F   12....       LCALL   ?Subroutine16 & 0xFFFF
    722                    HalUARTWrite(0,&asc_16[(currentMac[i])&0x0f],1); 
    723                  }
   \                     ??CrossCallReturnLabel_28:
   \   000122   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000125   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   000128   E5..         MOV     A,?V0 + 2
   \   00012A   C3           CLR     C
   \   00012B   9408         SUBB    A,#0x8
   \   00012D   40E6         JC      ??rfdata_handle_6
    724                  for(i=0;i<pkt->cmd.DataLength;i++){
   \   00012F   75..00       MOV     ?V0 + 2,#0x0
   \   000132   8018         SJMP    ??CrossCallReturnLabel_27
    725                    HalUARTWrite(0,&asc_16[(pkt->cmd.Data[i])>>4],1);  
   \                     ??rfdata_handle_7:
   \   000134   E5..         MOV     A,?V0 + 4
   \   000136   2422         ADD     A,#0x22
   \   000138   FE           MOV     R6,A
   \   000139   E5..         MOV     A,?V0 + 5
   \   00013B   12....       LCALL   ?Subroutine16 & 0xFFFF
    726                    HalUARTWrite(0,&asc_16[(pkt->cmd.Data[i])&0x0f],1); 
    727                  }
   \                     ??CrossCallReturnLabel_29:
   \   00013E   E0           MOVX    A,@DPTR
   \   00013F   12....       LCALL   ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   000142   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000145   12....       LCALL   ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000148   E0           MOVX    A,@DPTR
   \   000149   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   00014C   85....       MOV     ?V0 + 0,?V0 + 2
   \   00014F   E5..         MOV     A,?V0 + 4
   \   000151   2420         ADD     A,#0x20
   \   000153   F582         MOV     DPL,A
   \   000155   E5..         MOV     A,?V0 + 5
   \   000157   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00015A   F9           MOV     R1,A
   \   00015B   C3           CLR     C
   \   00015C   E5..         MOV     A,?V0 + 0
   \   00015E   98           SUBB    A,R0
   \   00015F   E4           CLR     A
   \   000160   99           SUBB    A,R1
   \   000161   40D1         JC      ??rfdata_handle_7
    728                  HalUARTWrite(0,"\r\n",2);
   \   000163                ; Setup parameters for call to function HalUARTWrite
   \   000163   7C02         MOV     R4,#0x2
   \   000165   7D00         MOV     R5,#0x0
   \   000167   7A..         MOV     R2,#`?<Constant "\\r\\n">` & 0xff
   \   000169   7B..         MOV     R3,#(`?<Constant "\\r\\n">` >> 8) & 0xff
   \   00016B   806C         SJMP    ??rfdata_handle_8
    729                }
    730                break;
    731              }
    732            case 5:
    733              {
    734                if(ZigLightApp_NwkState != DEV_ZB_COORD){
   \                     ??rfdata_handle_4:
   \   00016D   90....       MOV     DPTR,#ZigLightApp_NwkState
   \   000170   E0           MOVX    A,@DPTR
   \   000171   6409         XRL     A,#0x9
   \   000173   6069         JZ      ??rfdata_handle_2
    735                // 增加pwm控制程序
    736                //pwm_handle(on_off,w,r,g,b);
    737          
    738                  on_off  = pkt->cmd.Data[1];
   \   000175   EA           MOV     A,R2
   \   000176   2422         ADD     A,#0x22
   \   000178   FE           MOV     R6,A
   \   000179   EB           MOV     A,R3
   \   00017A   3400         ADDC    A,#0x0
   \   00017C   FF           MOV     R7,A
   \   00017D   8E82         MOV     DPL,R6
   \   00017F   8F83         MOV     DPH,R7
   \   000181   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000184   90....       MOV     DPTR,#on_off
   \   000187   12....       LCALL   ?Subroutine7 & 0xFFFF
    739                  white   = pkt->cmd.Data[2];
   \                     ??CrossCallReturnLabel_6:
   \   00018A   E0           MOVX    A,@DPTR
   \   00018B   90....       MOV     DPTR,#white
   \   00018E   12....       LCALL   ?Subroutine7 & 0xFFFF
    740                  red     = pkt->cmd.Data[3];
   \                     ??CrossCallReturnLabel_7:
   \   000191   A3           INC     DPTR
   \   000192   E0           MOVX    A,@DPTR
   \   000193   90....       MOV     DPTR,#red
   \   000196   12....       LCALL   ?Subroutine6 & 0xFFFF
    741                  green   = pkt->cmd.Data[4];
   \                     ??CrossCallReturnLabel_4:
   \   000199   E0           MOVX    A,@DPTR
   \   00019A   90....       MOV     DPTR,#green
   \   00019D   12....       LCALL   ?Subroutine6 & 0xFFFF
    742                  blue    = pkt->cmd.Data[5];
   \                     ??CrossCallReturnLabel_5:
   \   0001A0   A3           INC     DPTR
   \   0001A1   E0           MOVX    A,@DPTR
   \   0001A2   90....       MOV     DPTR,#blue
   \   0001A5   F0           MOVX    @DPTR,A
    743                  main_state = DEVICE_STATUS_CHANGE;
   \   0001A6   90....       MOV     DPTR,#main_state
   \   0001A9   7414         MOV     A,#0x14
   \   0001AB   12....       LCALL   ??Subroutine32_0 & 0xFFFF
    744                  sbuf_len = SendData_load(sbuf);
    745                  if(sbuf_len)
   \                     ??CrossCallReturnLabel_60:
   \   0001AE   6017         JZ      ??rfdata_handle_9
    746                    ZigLightApp_SendPointToPointMessage(&Point_To_Point_DstAddr,&ZigLightApp_epDesc,sbuf_len,sbuf);
   \   0001B0                ; Setup parameters for call to function ZigLightApp_SendPointToPointMessage
   \   0001B0   75....       MOV     ?V0 + 0,#sbuf & 0xff
   \   0001B3   75....       MOV     ?V0 + 1,#(sbuf >> 8) & 0xff
   \   0001B6   78..         MOV     R0,#?V0 + 0
   \   0001B8   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001BB   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   0001BE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001C1   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   0001C4   12....       LCALL   ?DEALLOC_XSTACK8
    747                  main_state = HEARTBEAT;
   \                     ??rfdata_handle_9:
   \   0001C7   90....       MOV     DPTR,#main_state
   \   0001CA   7413         MOV     A,#0x13
   \   0001CC   12....       LCALL   ?Subroutine5 & 0xFFFF
    748                  //重新计时3秒
    749                  osal_start_timerEx( ZigLightApp_TaskID, ZigLightApp_SEND_PERIODIC_MSG_EVT,
    750                      (ZigLightApp_SEND_PERIODIC_MSG_TIMEOUT ) );
    751                }
    752                break;
    753              }
   \                     ??CrossCallReturnLabel_3:
   \   0001CF   800D         SJMP    ??rfdata_handle_2
    754            default:
    755              {
    756                HalUARTWrite(0,"rf error\r\n",10);
   \                     ??rfdata_handle_5:
   \   0001D1                ; Setup parameters for call to function HalUARTWrite
   \   0001D1   7C0A         MOV     R4,#0xa
   \   0001D3   7D00         MOV     R5,#0x0
   \   0001D5   7A..         MOV     R2,#`?<Constant "rf error\\r\\n">` & 0xff
   \   0001D7   7B..         MOV     R3,#(`?<Constant "rf error\\r\\n">` >> 8) & 0xff
   \                     ??rfdata_handle_8:
   \   0001D9   7900         MOV     R1,#0x0
   \   0001DB   12....       LCALL   ??HalUARTWrite?relay
    757              }
    758            }
    759          //  if( (pkt->cmd.Data[0])==4 )
    760          //  {
    761          //    HalUARTWrite(0,"dstatus",7);
    762          //    HalUARTWrite(0,&asc_16[pkt->cmd.Data[0]],1);  
    763          //    HalUARTWrite(0,"\r\n",2);
    764          //  }
    765          }
   \                     ??rfdata_handle_2:
   \   0001DE   7410         MOV     A,#0x10
   \   0001E0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001E3                REQUIRE ?Subroutine2
   \   0001E3                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7F06         MOV     R7,#0x6
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   25..         ADD     A,?V0 + 0
   \   000002   F8           MOV     R0,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   3400         ADDC    A,#0x0
   \   000007   8882         MOV     DPL,R0
   \   000009   F583         MOV     DPH,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F8           MOV     R0,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   3400         ADDC    A,#0x0
   \   000002   FF           MOV     R7,A
   \   000003                ; Setup parameters for call to function HalUARTWrite
   \   000003                ; Setup parameters for call to function HalUARTWrite
   \   000003   7C01         MOV     R4,#0x1
   \   000005   7D00         MOV     R5,#0x0
   \   000007   8E82         MOV     DPL,R6
   \   000009   8F83         MOV     DPH,R7
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_54:
   \   000003   05..         INC     ?V0 + 2
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   A3           INC     DPTR
   \   000001   E0           MOVX    A,@DPTR
   \   000002   F583         MOV     DPH,A
   \   000004   8882         MOV     DPL,R0
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   C4           SWAP    A
   \   000002   540F         ANL     A,#0xf
   \   000004   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_70:
   \   000007   8E82         MOV     DPL,R6
   \   000009   8F83         MOV     DPH,R7
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   12....       LCALL   ?Subroutine24 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine24:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F8           MOV     R0,A
   \   000007   A3           INC     DPTR
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F583         MOV     DPH,A
   \   00000B   8882         MOV     DPL,R0
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   12....       LCALL   ?Subroutine24 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine26:
   \   000000   F8           MOV     R0,A
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007   E582         MOV     A,DPL
   \   000009   28           ADD     A,R0
   \   00000A                REQUIRE ??Subroutine34_0
   \   00000A                ; // Fall through to label ??Subroutine34_0
    766          /*********************************************************************
    767           * LOCAL FUNCTIONS
    768           */
    769          
    770          /*********************************************************************
    771           * @fn      ZigLightApp_MessageMSGCB
    772           *
    773           * @brief   Data message processor callback.  This function processes
    774           *          any incoming data - probably from other devices.  So, based
    775           *          on cluster ID, perform the intended action.
    776           *
    777           * @param   none
    778           *
    779           * @return  none
    780           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    781          void ZigLightApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     ZigLightApp_MessageMSGCB:
    782          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    783          //  uint16 flashTime;//temp;  
    784          //  uint8 *ptr;//i;//res;
    785          //  uint8 tp[10];
    786          //  uint8 index;
    787            //网蜂16进制转ASCII码表
    788          //    uint8 asc_16[16]={'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    789                               
    790            switch ( pkt->clusterId )
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   E0           MOVX    A,@DPTR
   \   000012   6403         XRL     A,#0x3
   \   000014   7002         JNZ     ??ZigLightApp_MessageMSGCB_0
   \   000016   A3           INC     DPTR
   \   000017   E0           MOVX    A,@DPTR
   \                     ??ZigLightApp_MessageMSGCB_0:
   \   000018   701E         JNZ     ??ZigLightApp_MessageMSGCB_1
    791            {
    792              case ZigLightApp_POINT_TO_POINT_CLUSTERID:  
    793                if(MacToAppFlag == 0 && AutoUpateMac == 0){//在读取mac时禁止zigbee操作
   \   00001A   90....       MOV     DPTR,#MacToAppFlag
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   7018         JNZ     ??ZigLightApp_MessageMSGCB_1
   \   000020   90....       MOV     DPTR,#AutoUpateMac
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7012         JNZ     ??ZigLightApp_MessageMSGCB_1
    794                  mac_table_fresh( pkt );
   \   000026                ; Setup parameters for call to function mac_table_fresh
   \   000026   12....       LCALL   ??mac_table_fresh?relay
    795                  if(newdevice_joinin != 3)
   \   000029   90....       MOV     DPTR,#newdevice_joinin
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   6403         XRL     A,#0x3
   \   00002F   6007         JZ      ??ZigLightApp_MessageMSGCB_1
    796                    rfdata_handle( pkt );
   \   000031                ; Setup parameters for call to function rfdata_handle
   \   000031   EE           MOV     A,R6
   \   000032   FA           MOV     R2,A
   \   000033   EF           MOV     A,R7
   \   000034   FB           MOV     R3,A
   \   000035   12....       LCALL   ??rfdata_handle?relay
    797                }
    798          //      if(blink_finished == 0){
    799          //        HalLedBlink( HAL_LED_1, 4, 50, 3000 );
    800          //        blink_finished = 1;
    801          //      }
    802          //      temp=pkt->srcAddr.addr.shortAddr; //读出数据包的16位短地址
    803          //      for(i=0;i<pkt->cmd.DataLength;i++)
    804          //      {
    805          //        HalUARTWrite(0,&asc_16[pkt->cmd.Data[i]%256/16],1);
    806          //        HalUARTWrite(0,&asc_16[pkt->cmd.Data[i]%16],1);  
    807          //      }
    808          //      HalUARTWrite(0,"\r",1);
    809          //      HalUARTWrite(0,"\n",1);               // 回车换行
    810          //      if (   (ZigLightApp_NwkState == DEV_ZB_COORD) ){
    811          //        if( ((pkt->cmd.Data[1])&0x03)==1 ) //路由器        
    812          //          HalUARTWrite(0,"ROUTER ShortAddr:0x",19); //提示接收到数据
    813          //        if( ((pkt->cmd.Data[1])&0x03)==2 ) //终端
    814          //          HalUARTWrite(0,"ENDDEVICE ShortAddr:0x",22); //提示接收到数据
    815          //          /****将短地址分解，ASC码打印*****/
    816          //        HalUARTWrite(0,&asc_16[temp/4096],1);
    817          //        HalUARTWrite(0,&asc_16[temp%4096/256],1);
    818          //        HalUARTWrite(0,&asc_16[temp%256/16],1);
    819          //        HalUARTWrite(0,&asc_16[temp%16],1);  
    820          //        HalUARTWrite(0,"\r",1);
    821          //        HalUARTWrite(0,"\n",1);               // 回车换行
    822          //      }
    823                break;
    824          
    825          //    case ZigLightApp_FLASH_CLUSTERID:
    826          //      flashTime = BUILD_UINT16(pkt->cmd.Data[1], pkt->cmd.Data[2] );
    827          //      HalLedBlink( HAL_LED_4, 4, 50, (flashTime / 4) );
    828          //      break;
    829            }
    830          }
   \                     ??ZigLightApp_MessageMSGCB_1:
   \   000038   02....       LJMP    ?Subroutine1 & 0xFFFF
    831          
    832          /*********************************************************************
    833           * @fn      ZigLightApp_SendPeriodicMessage
    834           *
    835           * @brief   Send the periodic message.
    836           *
    837           * @param   none
    838           *
    839           * @return  none
    840           */
    841          //by liu
    842          //void ZigLightApp_SendPeriodicMessage( void )
    843          //{
    844          //  uint8 data[10]={'0','1','2','3','4','5','6','7','8','9'};//自定义数据
    845          //  if ( AF_DataRequest( &ZigLightApp_Periodic_DstAddr, &ZigLightApp_epDesc,
    846          //                       ZigLightApp_PERIODIC_CLUSTERID,
    847          //                       10,//字节数
    848          //                       data,//指针头
    849          //                       &ZigLightApp_TransID,
    850          //                       AF_DISCV_ROUTE,
    851          //                       AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    852          //  {
    853          //  }
    854          //  else
    855          //  {
    856          //    // Error occurred in request to send.
    857          //  }
    858          //}
    859          
    860          /*********************************************************************
    861           * @fn      ZigLightApp_SendFlashMessage
    862           *
    863           * @brief   Send the flash message to group 1.
    864           *
    865           * @param   flashTime - in milliseconds
    866           *
    867           * @return  none
    868           */
    869          //by liu
    870          //void ZigLightApp_SendFlashMessage( uint16 flashTime )
    871          //{
    872          //  uint8 buffer[3];
    873          //  buffer[0] = (uint8)(ZigLightAppFlashCounter++);
    874          //  buffer[1] = LO_UINT16( flashTime );
    875          //  buffer[2] = HI_UINT16( flashTime );
    876          //
    877          //  if ( AF_DataRequest( &ZigLightApp_Flash_DstAddr, &ZigLightApp_epDesc,
    878          //                       ZigLightApp_FLASH_CLUSTERID,
    879          //                       3,
    880          //                       buffer,
    881          //                       &ZigLightApp_TransID,
    882          //                       AF_DISCV_ROUTE,
    883          //                       AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    884          //  {
    885          //  }
    886          //  else
    887          //  {
    888          //    // Error occurred in request to send.
    889          //  }
    890          //}
    891          
    892          /*********************************************************************
    893          ZigLightApp_SendPointToPointMessage(&Point_To_Point_DstAddr,&ZigLightApp_epDesc,1,&device);
    894          *********************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    895          void ZigLightApp_SendPointToPointMessage( afAddrType_t * dstaddr , endPointDesc_t * epdesc , uint16 len , uint8 * buf  )
   \                     ZigLightApp_SendPointToPointMessage:
    896          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   740E         MOV     A,#0xe
   \   000007   12....       LCALL   ?XSTACK_DISP0_8
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F5..         MOV     ?V0 + 0,A
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F5..         MOV     ?V0 + 1,A
   \   000011   7410         MOV     A,#0x10
   \   000013   12....       LCALL   ?XSTACK_DISP0_8
   \   000016   E0           MOVX    A,@DPTR
   \   000017   F5..         MOV     ?V0 + 2,A
   \   000019   A3           INC     DPTR
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F5..         MOV     ?V0 + 3,A
    897            
    898            
    899            if ( AF_DataRequest( dstaddr,  //发送设备类型编号
    900                                 epdesc,
    901                                 ZigLightApp_POINT_TO_POINT_CLUSTERID,
    902                                 len,
    903                                 buf,
    904                                 &ZigLightApp_TransID,
    905                                 AF_DISCV_ROUTE,
    906                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   00001D                ; Setup parameters for call to function AF_DataRequest
   \   00001D   75..1E       MOV     ?V0 + 4,#0x1e
   \   000020   78..         MOV     R0,#?V0 + 4
   \   000022   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000025   75....       MOV     ?V0 + 4,#ZigLightApp_TransID & 0xff
   \   000028   75....       MOV     ?V0 + 5,#(ZigLightApp_TransID >> 8) & 0xff
   \   00002B   78..         MOV     R0,#?V0 + 4
   \   00002D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000030   78..         MOV     R0,#?V0 + 2
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..03       MOV     ?V0 + 0,#0x3
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   7920         MOV     R1,#0x20
   \   000047   12....       LCALL   ??AF_DataRequest?relay
   \   00004A   7409         MOV     A,#0x9
   \   00004C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004F   E9           MOV     A,R1
   \   000050   7006         JNZ     ??ZigLightApp_SendPointToPointMessage_0
    907            {
    908              ZigLightApp_TransID++;
   \   000052   90....       MOV     DPTR,#ZigLightApp_TransID
   \   000055   E0           MOVX    A,@DPTR
   \   000056   04           INC     A
   \   000057   F0           MOVX    @DPTR,A
    909            }
    910            else
    911            {
    912              // Error occurred in request to send.
    913            }
    914          
    915          }
   \                     ??ZigLightApp_SendPointToPointMessage_0:
   \   000058   02....       LJMP    ?Subroutine2 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for self_index>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for main_state>`:
   \   000000   11           DB 17

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZigLightApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZigLightApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SendData_load?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SendData_load

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??serial_data_handle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    serial_data_handle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZigLightApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZigLightApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZigLightApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZigLightApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZigLightApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZigLightApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??rfdata_handle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    rfdata_handle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZigLightApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZigLightApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZigLightApp_SendPointToPointMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZigLightApp_SendPointToPointMessage

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "giziwit set mode\\n">`:
   \   000000   67697A69     DB "giziwit set mode\012"
   \            77697420
   \            73657420
   \            6D6F6465
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Group 1">`:
   \   000000   47726F75     DB "Group 1"
   \            70203100

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "error cmd type\\r">`:
   \   000000   6572726F     DB "error cmd type\015"
   \            7220636D
   \            64207479
   \            70650D00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "can\\'t find MAC device\\r">`:
   \   000000   63616E27     DB "can't find MAC device\015"
   \            74206669
   \            6E64204D
   \            41432064
   \            65766963
   \            650D00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56`:
   \   000000   30           DB 48
   \   000001   31           DB 49
   \   000002   32           DB 50
   \   000003   33           DB 51
   \   000004   34           DB 52
   \   000005   35           DB 53
   \   000006   36           DB 54
   \   000007   37           DB 55
   \   000008   38           DB 56
   \   000009   39           DB 57
   \   00000A   41           DB 65
   \   00000B   42           DB 66
   \   00000C   43           DB 67
   \   00000D   44           DB 68
   \   00000E   45           DB 69
   \   00000F   46           DB 70

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "\\r\\n">`:
   \   000000   0D0A00       DB "\015\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "\\n">`:
   \   000000   0A00         DB "\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "ZTOOL\\r">`:
   \   000000   5A544F4F     DB "ZTOOL\015"
   \            4C0D00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SERIAL\\r">`:
   \   000000   53455249     DB "SERIAL\015"
   \            414C0D00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56_1`:
   \   000000   30           DB 48
   \   000001   31           DB 49
   \   000002   32           DB 50
   \   000003   33           DB 51
   \   000004   34           DB 52
   \   000005   35           DB 53
   \   000006   36           DB 54
   \   000007   37           DB 55
   \   000008   38           DB 56
   \   000009   39           DB 57
   \   00000A   41           DB 65
   \   00000B   42           DB 66
   \   00000C   43           DB 67
   \   00000D   44           DB 68
   \   00000E   45           DB 69
   \   00000F   46           DB 70

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "\\nR">`:
   \   000000   0A5200       DB "\012R"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "S">`:
   \   000000   5300         DB "S"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "stat:">`:
   \   000000   73746174     DB "stat:"
   \            3A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "rf error\\r\\n">`:
   \   000000   72662065     DB "rf error\015\012"
   \            72726F72
   \            0D0A00  

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     SendData_load                      3      0     30
     ZigLightApp_HandleKeys             0      0     21
       -> gizwitsSetMode                0      0     18
     ZigLightApp_Init                   0      0     14
       -> MT_UartInit                   0      0     22
       -> MT_UartRegisterTaskID         0      0     22
       -> HalUARTWrite                  0      0     22
       -> osal_memset                   0      0     22
       -> gizwitsInit                   0      0     22
       -> initList                      0      0     22
       -> ZDO_RegisterForZDOMsg         0      0     22
       -> afRegister                    0      0     22
       -> RegisterForKeys               0      0     22
       -> osal_memcpy                   0      0     28
       -> aps_AddGroup                  0      0     22
     ZigLightApp_MessageMSGCB           0      0     21
       -> mac_table_fresh               0      0     18
       -> rfdata_handle                 0      0     18
     ZigLightApp_ProcessEvent           0      0     16
       -> osal_msg_receive              0      0     24
       -> HalUARTWrite                  0      0     24
       -> serial_data_handle            0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> ZigLightApp_ProcessZDOMsgs
                                        0      0     24
       -> ZigLightApp_HandleKeys        0      0     24
       -> ZigLightApp_MessageMSGCB      0      0     24
       -> osal_start_timerEx            0      0     24
       -> HalUARTWrite                  0      0     24
       -> detectHandle                  0      0     24
       -> SendData_load                 0      0     24
       -> ZigLightApp_SendPointToPointMessage
                                        0      0     32
       -> osal_rand                     0      0     24
       -> osal_start_timerEx            0      0     24
       -> osal_rand                     0      0     24
       -> osal_start_timerEx            0      0     24
       -> osal_rand                     0      0     24
       -> osal_start_timerEx            0      0     24
     ZigLightApp_ProcessZDOMsgs         2      0     44
       -> ZDO_ParseAddrRsp              0      0     56
       -> searchfromList                0      0     56
       -> insertLastList                0      0     60
       -> HalUARTWrite                  0      0     56
       -> HalUARTWrite                  0      0     56
       -> HalUARTWrite                  0      0     56
       -> HalUARTWrite                  0      0     56
       -> HalUARTWrite                  0      0     56
       -> SendData_load                 0      0     56
       -> ZigLightApp_SendPointToPointMessage
                                        0      0     64
     ZigLightApp_SendPointToPointMessage
                                        0      0     57
       -> AF_DataRequest                0      0     46
     rfdata_handle                      2      0     43
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> SendData_load                 0      0     60
       -> ZigLightApp_SendPointToPointMessage
                                        0      0     68
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> HalUARTWrite                  0      0     60
       -> SendData_load                 0      0     60
       -> ZigLightApp_SendPointToPointMessage
                                        0      0     68
       -> osal_start_timerEx            0      0     60
       -> HalUARTWrite                  0      0     60
     serial_data_handle                 1      0     28
       -> HalUARTWrite                  0      0     24
       -> APSME_LookupNwkAddr           0      0     24
       -> HalUARTWrite                  0      0     24
       -> SendData_load                 0      0     24
       -> ZigLightApp_SendPointToPointMessage
                                        0      0     32


   Segment part sizes:

     Function/Label                                   Bytes
     --------------                                   -----
     ZigLightApp_ClusterList                             6
     ZigLightApp_SimpleDesc                             12
     ZigLightApp_epDesc                                  6
     ZigLightApp_TaskID                                  1
     ZigLightApp_NwkState                                1
     ZigLightApp_TransID                                 1
     ZigLightApp_Periodic_DstAddr                       12
     ZigLightApp_Flash_DstAddr                          12
     Point_To_Point_DstAddr                             12
     Self_DstAddr                                       12
     Self_zDstAddr                                       9
     self_index                                          1
     sbuf                                                6
     sbuf_len                                            1
     on_off                                              1
     white                                               1
     red                                                 1
     green                                               1
     blue                                                1
     gizwits_buf                                        20
     main_state                                          1
     nodelist                                            2
     deletnodelist                                       2
     newdevice_joinin                                    1
     ZigLightApp_Group                                  18
     ZigLightAppPeriodicCounter                          1
     ZigLightAppFlashCounter                             1
     currentDataPoint                                   20
     ZigLightApp_Init                                  224
     SendData_load                                     290
     ?Subroutine14                                       6
     ?Subroutine28                                       7
     ?Subroutine10                                       9
     ?Subroutine18                                      12
     ?Subroutine20                                       3
     ??Subroutine33_0                                    5
     serial_data_handle                                174
     ?Subroutine21                                       4
     ?Subroutine31                                      13
     ?Subroutine17                                      14
     ?Subroutine11                                      12
     ?Subroutine27                                      14
     ZigLightApp_ProcessZDOMsgs                        224
     ?Subroutine0                                        5
     ?Subroutine4                                       10
     ??Subroutine32_0                                    5
     ?Subroutine13                                      11
     ?Subroutine8                                       14
     ?Subroutine3                                       26
     ?Subroutine30                                      19
     ?Subroutine29                                      24
     ??Subroutine34_0                                    6
     ??Subroutine35_0                                   10
     ?Subroutine25                                       9
     ZigLightApp_ProcessEvent                          313
     ?Subroutine23                                      11
     ?Subroutine5                                       18
     ZigLightApp_HandleKeys                             15
     ?Subroutine1                                        5
     rfdata_handle                                     483
     ?Subroutine2                                        5
     ?Subroutine22                                      12
     ?Subroutine19                                       9
     ?Subroutine16                                      12
     ?Subroutine15                                       6
     ?Subroutine12                                       9
     ?Subroutine9                                       13
     ?Subroutine7                                        4
     ?Subroutine24                                      16
     ?Subroutine6                                        6
     ?Subroutine26                                      10
     ZigLightApp_MessageMSGCB                           59
     ZigLightApp_SendPointToPointMessage
                                                        91
     ?<Initializer for self_index>                       1
     ?<Initializer for main_state>                       1
     ??ZigLightApp_Init?relay                            6
     ??SendData_load?relay                               6
     ??serial_data_handle?relay                          6
     ??ZigLightApp_ProcessZDOMsgs?relay                  6
     ??ZigLightApp_ProcessEvent?relay                    6
     ??ZigLightApp_HandleKeys?relay                      6
     ??rfdata_handle?relay                               6
     ??ZigLightApp_MessageMSGCB?relay                    6
     ??ZigLightApp_SendPointToPointMessage?relay         6
     ?<Constant "giziwit set mode\n">                   18
     ?<Constant "Group 1">                               8
     ?<Constant "error cmd type\r">                     16
     ?<Constant "can\'t find MAC device\r">             23
     ?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56     16
     ?<Constant "\r\n">                                  3
     ?<Constant "\n">                                    2
     ?<Constant "ZTOOL\r">                               7
     ?<Constant "SERIAL\r">                              8
     ?<Constant {48, 49, 50, 51, 52, 53, 54, 55, 56_1   16
     ?<Constant "\nR">                                   3
     ?<Constant "S">                                     2
     ?<Constant "stat:">                                 6
     ?<Constant "rf error\r\n">                         11

 
 2 247 bytes in segment BANKED_CODE
    54 bytes in segment BANK_RELAYS
     2 bytes in segment XDATA_I
     2 bytes in segment XDATA_ID
   157 bytes in segment XDATA_ROM_C
   143 bytes in segment XDATA_Z
 
 2 303 bytes of CODE  memory
   157 bytes of CONST memory
   145 bytes of XDATA memory

Errors: none
Warnings: none
